
Báº£n thÃ¢n tÃ i liá»‡u nÃ y khÃ´ng Ä‘á»§ vá»›i kiáº¿n thá»©c HTB muá»‘n dáº¡y, cáº§n xem thÃªm á»Ÿ https://academy.hackthebox.com/module/116/section/1167 
Nhiá»u case khÃ´ng dÃ¹ng Ä‘áº¿n nÃªn cÃ³ thá»ƒ khÃ´ng nhá»›. 

Lá»— há»•ng cuá»‘i cÃ¹ng cá»§a SMB : https://academy.hackthebox.com/module/116/section/1168


# ğŸ“˜ Táº¤N CÃ”NG SMB â€“ Mindmap Dáº¡ng DÃ n Ã (Outline Mindmap)
**PhiÃªn báº£n .md hoÃ n chá»‰nh â€“ Ä‘áº§y Ä‘á»§, Ä‘áº¹p, kÃ¨m má»¥c lá»¥c & Mermaid Mindmaps**

---

# ğŸ“‘ **Má»¤C Lá»¤C**
1. [Giá»›i thiá»‡u](#giá»›i-thiá»‡u)
2. [Mindmap Mermaid â€“ Outline Style](#mindmap-mermaid--outline-style)
3. [DÃ n Ã½ chi tiáº¿t (Outline)](#dÃ n-Ã½-chi-tiáº¿t-outline)
4. [Kiáº¿n thá»©c theo tá»«ng nhÃ³m](#kiáº¿n-thá»©c-theo-tá»«ng-nhÃ³m)
5. [Phá»¥ lá»¥c: Lá»‡nh quan trá»ng SMB](#phá»¥-lá»¥c-lá»‡nh-quan-trá»ng-smb)

---

# ## Giá»›i thiá»‡u
TÃ i liá»‡u nÃ y trÃ¬nh bÃ y **toÃ n bá»™ kiáº¿n thá»©c SMB** dÆ°á»›i dáº¡ng:

- Mindmap Mermaid theo phong cÃ¡ch **dÃ n Ã½**
- Dá»… Ä‘á»c â€“ dá»… nhá»› â€“ dá»… thá»±c hÃ nh
- CÃ³ Ä‘áº§y Ä‘á»§ lá»‡nh SMB quan trá»ng
- CÃ³ má»¥c lá»¥c tá»± Ä‘á»™ng

---

# ## Mindmap Mermaid â€“ Outline Style

```mermaid
mindmap
  root((Táº¤N CÃ”NG SMB â€“ DÃ€N Ã))

    I. KhÃ¡i niá»‡m & Cáº¥u hÃ¬nh
      1. Má»¥c Ä‘Ã­ch
        - Chia sáº» File
        - Chia sáº» MÃ¡y in
        - Truy cáº­p tÃ i nguyÃªn tá»« xa
      2. Ports
        - 139 (NetBIOS)
        - 445 (SMB trá»±c tiáº¿p)
        - UDP 137,138
      3. Triá»ƒn khai
        - Samba (Linux)
        - SMBv1/v2/v3
      4. Giao thá»©c liÃªn quan
        - MSRPC
        - Named Pipes

    II. Thu tháº­p dá»¯ liá»‡u (Enumeration)
      1. Nmap
        - nmap -sV -p 139,445 <IP>
        - Liá»‡t kÃª phiÃªn báº£n SMB
      2. SMBMap / CrackMapExec
        - smbmap -H <IP>
        - cme smb <IP> --shares
      3. Null Session
        - KhÃ´ng cáº§n username/password
        - Liá»‡t kÃª users & groups
      4. SMBClient
        - smbclient -N -L //<IP>/
        - smbclient //<IP>/Share
      5. RPC Enumeration
        - rpcclient -U "" <IP>
      6. CÃ´ng cá»¥ tá»± Ä‘á»™ng
        - enum4linux
        - enum4linux-ng

    III. Táº¥n cÃ´ng Misconfig
      1. Password Attacks
        - Hydra / Medusa
        - Password spraying
      2. SMB RCE
        - psexec.py
        - smbexec.py
        - wmiexec.py
      3. Pass-the-Hash
        - Sá»­ dá»¥ng NTLM Hash Ä‘Äƒng nháº­p
      4. Net-NTLM Relay
        - Responder
        - ntlmrelayx.py
      5. RPC Abuse
        - Táº¡o user
        - Láº¥y thÃ´ng tin nháº¡y cáº£m

    IV. Táº¥n cÃ´ng NÃ¢ng cao
      1. Lateral Movement
      2. Privilege Escalation
      3. Persistence
```

---

# ## DÃ n Ã½ chi tiáº¿t (Outline)

### **I. KhÃ¡i niá»‡m SMB**
- DÃ¹ng Ä‘á»ƒ chia sáº» File / Printer  
- Há»— trá»£ truy cáº­p tÃ i nguyÃªn tá»« xa  
- Ports:
  - 139 (NetBIOS)
  - 445 (SMB Direct)
- Triá»ƒn khai:
  - SMBv1 â€“ lá»—i thá»i, nhiá»u lá»— há»•ng
  - SMBv2/v3 â€“ báº£o máº­t hÆ¡n
  - Samba trÃªn Linux  
- Giao thá»©c liÃªn quan:
  - MSRPC  
  - Named Pipes â†’ cá»±c quan trá»ng cho RCE

---

### **II. Enumeration**
#### 1. Nmap
```
nmap -sV -p 139,445 <IP>
```

#### 2. SMBMap
```
smbmap -H <IP>
smbmap -u user -p pass -H <IP>
```

#### 3. CrackMapExec (CME)
```
cme smb <IP> --shares
cme smb <IP> -u user -p pass
```

#### 4. Null Session
```
rpcclient -U "" <IP>
```

#### 5. Truy cáº­p Shares
```
smbclient -N -L //<IP>/
smbclient //<IP>/Share
```

#### 6. Tá»± Ä‘á»™ng hÃ³a
```
enum4linux -a <IP>
enum4linux-ng <IP>
```

---

### **III. Táº¥n cÃ´ng Misconfig**
#### 1. Password Attacks
- **Brute force:** Hydra, Medusa  
- **Spraying:** 1 password thá»­ cho nhiá»u user  

#### 2. RCE trÃªn SMB
```
psexec.py domain/user:pass@<IP>
smbexec.py
wmiexec.py
```

#### 3. Pass-the-Hash
```
psexec.py user@<IP> -hashes <NTLM>
cme smb <IP> -u user -H <NTLM>
```

#### 4. Net-NTLM Relay
```
responder -I eth0
ntlmrelayx.py -tf targets.txt
```

#### 5. RPC Abuse
```
rpcclient -U "" <IP>
```
- Liá»‡t kÃª user  
- Táº¡o user  
- Enumerate domain info  

---

# ## Phá»¥ lá»¥c: Lá»‡nh quan trá»ng SMB

### â— Nmap
```
nmap -sV -p 139,445 <IP>
```

### â— SMBMap
```
smbmap -H <IP>
```

### â— SMBClient
```
smbclient -N -L //<IP>/
```

### â— CME
```
cme smb <IP> --shares
```

### â— Impacket RCE
```
psexec.py user:pass@<IP>
```

### â— Relay Attack
```
responder -I eth0
ntlmrelayx.py -tf targets.txt
```








# ğŸ“˜ Tá»•ng há»£p lá»‡nh **smbclient** â€“ Báº£ng Ä‘áº§y Ä‘á»§ (Lá»‡nh + Äá»‹nh nghÄ©a + VÃ­ dá»¥)

---

# ğŸ“‘ Má»¤C Lá»¤C
1. Lá»‡nh Ä‘iá»u hÆ°á»›ng & quáº£n lÃ½ thÆ° má»¥c
2. Lá»‡nh thao tÃ¡c file
3. Lá»‡nh nÃ¢ng cao / backup
4. Lá»‡nh phiÃªn lÃ m viá»‡c / káº¿t ná»‘i
5. Lá»‡nh cáº¥u hÃ¬nh truyá»n file
6. Top 10 lá»‡nh SMBclient dÃ¹ng nhiá»u nháº¥t

---

# ## 1. Lá»‡nh Ä‘iá»u hÆ°á»›ng & quáº£n lÃ½ thÆ° má»¥c

| Lá»‡nh | Äá»‹nh nghÄ©a | VÃ­ dá»¥ |
|------|------------|-------|
| `ls` | Liá»‡t kÃª file vÃ  thÆ° má»¥c trÃªn SMB share | `ls` |
| `cd <dir>` | Chuyá»ƒn thÆ° má»¥c trÃªn SMB server | `cd Documents` |
| `pwd` | Hiá»ƒn thá»‹ thÆ° má»¥c hiá»‡n táº¡i trÃªn SMB | `pwd` |
| `lcd <path>` | Chuyá»ƒn thÆ° má»¥c **local** | `lcd /tmp` |
| `lpwd` | Hiá»ƒn thá»‹ thÆ° má»¥c local hiá»‡n táº¡i | `lpwd` |
| `mkdir <dir>` | Táº¡o thÆ° má»¥c trÃªn SMB share | `mkdir uploads` |
| `rmdir <dir>` | XÃ³a thÆ° má»¥c SMB | `rmdir old_backup` |
| `recurse ON/OFF` | Báº­t/táº¯t táº£i recursive | `recurse ON` |

---

# ## 2. Lá»‡nh thao tÃ¡c file

| Lá»‡nh | Äá»‹nh nghÄ©a | VÃ­ dá»¥ |
|------|------------|-------|
| `get <file>` | Táº£i file vá» local | `get creds.txt` |
| `mget *` | Táº£i nhiá»u file | `mget *.txt` |
| `put <file>` | Upload file | `put shell.aspx` |
| `mput *` | Upload nhiá»u file | `mput *.log` |
| `rm <file>` | XÃ³a file | `rm old.txt` |
| `rename <old> <new>` | Äá»•i tÃªn file | `rename config.old config.php` |
| `more <file>` | Xem ná»™i dung file | `more notes.txt` |
| `allinfo <file>` | Metadata file | `allinfo report.pdf` |
| `stat <file>` | ThÃ´ng tin file | `stat secrets.txt` |
| `symlink <a> <b>` | Táº¡o symbolic link | `symlink log.txt link.txt` |
| `readlink <file>` | Xem symbolic link | `readlink link.txt` |

---

# ## 3. Lá»‡nh nÃ¢ng cao / backup

| Lá»‡nh | Äá»‹nh nghÄ©a | VÃ­ dá»¥ |
|------|------------|-------|
| `tar <opts>` | Táº£i share dáº¡ng TAR | `tar c backup.tar` |
| `tarmode <mode>` | Cháº¿ Ä‘á»™ tar | `tarmode full` |
| `reput <path>` | Upload láº¡i file | `reput test.txt` |

---

# ## 4. Lá»‡nh phiÃªn lÃ m viá»‡c / káº¿t ná»‘i

| Lá»‡nh | Äá»‹nh nghÄ©a | VÃ­ dá»¥ |
|------|------------|-------|
| `help` | Danh sÃ¡ch lá»‡nh | `help rm` |
| `history` | Lá»‹ch sá»­ lá»‡nh | `history` |
| `cancel` | Há»§y thao tÃ¡c | `cancel` |
| `showconnect` | ThÃ´ng tin káº¿t ná»‘i | `showconnect` |
| `logon <user%pass>` | ÄÄƒng nháº­p láº¡i | `logon admin%123` |
| `quit` / `exit` | ThoÃ¡t | `exit` |

---

# ## 5. Lá»‡nh cáº¥u hÃ¬nh truyá»n file

| Lá»‡nh | Äá»‹nh nghÄ©a | VÃ­ dá»¥ |
|------|------------|-------|
| `setmode binary/text` | Chá»n mode truyá»n file | `setmode binary` |
| `translate <rule>` | Quy táº¯c chuyá»ƒn Ä‘á»•i kÃ½ tá»± | `translate ascii` |
| `mask <pattern>` | Lá»c file | `mask *.log` |

---

# ## Top 10 lá»‡nh SMBclient dÃ¹ng nhiá»u nháº¥t

| Má»¥c Ä‘Ã­ch | Lá»‡nh |
|---------|------|
| Liá»‡t kÃª share | `smbclient -N -L //<IP>/` |
| Truy cáº­p share | `smbclient //<IP>/SHARE -N` |
| Liá»‡t kÃª file | `ls` |
| Xem file nháº¡y cáº£m | `more <file>` |
| Táº£i file | `get <file>` |
| Táº£i hÃ ng loáº¡t | `recurse ON` â†’ `mget *` |
| Upload shell | `put shell.aspx` |
| XÃ³a file | `rm <file>` |
| XÃ³a thÆ° má»¥c | `rmdir <dir>` |
| Xem quyá»n file | `allinfo <file>` |

---

# ğŸ‰ HoÃ n táº¥t file smbclient!




