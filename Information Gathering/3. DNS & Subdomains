DNS (Domain Name System) lÃ  há»‡ thá»‘ng giÃºp chuyá»ƒn Ä‘á»•i tÃªn miá»n dá»… nhá»› (nhÆ° www.example.com) thÃ nh Ä‘á»‹a chá»‰ IP sá»‘ (nhÆ° 192.0.2.1) mÃ  mÃ¡y tÃ­nh sá»­ dá»¥ng Ä‘á»ƒ giao tiáº¿p.
NÃ³ hoáº¡t Ä‘á»™ng tÆ°Æ¡ng tá»± nhÆ° GPS cá»§a Internet, giÃºp ngÆ°á»i dÃ¹ng Ä‘áº¿n Ä‘Ãºng â€œÄ‘á»‹a chá»‰â€ trÃªn máº¡ng mÃ  khÃ´ng cáº§n nhá»› cÃ¡c dÃ£y sá»‘ phá»©c táº¡p.
Lá»£i Ã­ch chÃ­nh: giÃºp viá»‡c truy cáº­p website trá»Ÿ nÃªn Ä‘Æ¡n giáº£n, tiá»‡n lá»£i vÃ  hiá»‡u quáº£ â€” ngÆ°á»i dÃ¹ng chá»‰ cáº§n nháº­p tÃªn miá»n thay vÃ¬ Ä‘á»‹a chá»‰ IP.
Náº¿u khÃ´ng cÃ³ DNS, viá»‡c truy cáº­p Internet sáº½ ráº¥t khÃ³ khÄƒn, giá»‘ng nhÆ° lÃ¡i xe mÃ  khÃ´ng cÃ³ báº£n Ä‘á»“ hay GPS.

How DNS Works
Imagine you want to visit a website like www.example.com. You type this friendly domain name into your browser, but your computer doesn't understand words â€“ it speaks the language of numbers, specifically IP addresses. So, how does your computer find the website's IP address? Enter DNS, the internet's trusty translator.
              
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚        Your Computer       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Checks Cache â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  IP Found?  â”‚
                 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   Yes â”‚  No
                       â”‚
                       â”‚
                       â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Sends DNS Query to Resolver â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         DNS Resolver         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Checks Cache â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ IP Found?    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           Yes  â”‚  No
                                â”‚
                                â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Recursive Lookup   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Root Name Server    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     TLD Name Server     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      Authoritative Name Server         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Returns IP to Computer â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Connects to Website     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Your Computer Asks for Directions (DNS Query): When you enter the domain name, your computer first checks its memory (cache) to see if it remembers the IP address from a previous visit. If not, it reaches out to a DNS resolver, usually provided by your internet service provider (ISP).
The DNS Resolver Checks its Map (Recursive Lookup): The resolver also has a cache, and if it doesn't find the IP address there, it starts a journey through the DNS hierarchy. It begins by asking a root name server, which is like the librarian of the internet.
Root Name Server Points the Way: The root server doesn't know the exact address but knows who does â€“ the Top-Level Domain (TLD) name server responsible for the domain's ending (e.g., .com, .org). It points the resolver in the right direction.
TLD Name Server Narrows It Down: The TLD name server is like a regional map. It knows which authoritative name server is responsible for the specific domain you're looking for (e.g., example.com) and sends the resolver there.
Authoritative Name Server Delivers the Address: The authoritative name server is the final stop. It's like the street address of the website you want. It holds the correct IP address and sends it back to the resolver.
The DNS Resolver Returns the Information: The resolver receives the IP address and gives it to your computer. It also remembers it for a while (caches it), in case you want to revisit the website soon.
Your Computer Connects: Now that your computer knows the IP address, it can connect directly to the web server hosting the website, and you can start browsing.



The Hosts File
  The hosts file is a simple text file used to map hostnames to IP addresses, providing a manual method of domain name resolution that bypasses the DNS process. While DNS automates the translation of domain names to IP addresses, the hosts file allows for direct, local overrides. This can be particularly useful for development, troubleshooting, or blocking websites.
  The hosts file is located in C:\Windows\System32\drivers\etc\hosts on Windows and in /etc/hosts on Linux and MacOS. Each line in the file follows the format:
    ( tá»‡p host nÃ³ ghi Ä‘Ã¨ domain á»©ng vá»›i IP trÆ°á»›c luÃ´n k cáº§n há»i DNS ) 

      127.0.0.1       localhost
      192.168.1.10    devserver.local

Key DNS Concepts
  In the Domain Name System (DNS), a zone is a distinct part of the domain namespace that a specific entity or administrator manages. Think of it as a virtual container for a set of domain names. For example, example.com and all its subdomains (like mail.example.com or blog.example.com) would typically belong to the same DNS zone.
  The zone file, a text file residing on a DNS server, defines the resource records (discussed below) within this zone, providing crucial information for translating domain names into IP addresses.
  To illustrate, here's a simplified example of what a zone file, for example.com might look like:

      $TTL 3600 ; Default Time-To-Live (1 hour)
      @       IN SOA   ns1.example.com. admin.example.com. (
                      2024060401 ; Serial number (YYYYMMDDNN)
                      3600       ; Refresh interval
                      900        ; Retry interval
                      604800     ; Expire time
                      86400 )    ; Minimum TTL
      
      @       IN NS    ns1.example.com.
      @       IN NS    ns2.example.com.
      @       IN MX 10 mail.example.com.
      www     IN A     192.0.2.1
      mail    IN A     198.51.100.1
      ftp     IN CNAME www.example.com.

This file defines the authoritative name servers (NS records), mail server (MX record), and IP addresses (A records) for various hosts within the example.com domain.

DNS servers store various resource records, each serving a specific purpose in the domain name resolution process. Let's explore some of the most common DNS concepts:

  | **DNS Concept**               | **Description**                                                       | **Example**                                               |
  | ----------------------------- | --------------------------------------------------------------------- | --------------------------------------------------------- |
  | **Domain Name**               | TÃªn miá»n â€“ nhÃ£n dá»… Ä‘á»c Ä‘áº¡i diá»‡n cho website hoáº·c tÃ i nguyÃªn Internet. | `www.example.com`                                         |
  | **IP Address**                | Äá»‹a chá»‰ sá»‘ duy nháº¥t Ä‘Æ°á»£c gÃ¡n cho má»—i thiáº¿t bá»‹ káº¿t ná»‘i Internet.       | `192.0.2.1`                                               |
  | **DNS Resolver**              | MÃ¡y chá»§ dá»‹ch tÃªn miá»n sang Ä‘á»‹a chá»‰ IP.                                | DNS cá»§a ISP hoáº·c DNS cÃ´ng cá»™ng nhÆ° Google DNS (`8.8.8.8`) |
  | **Root Name Server**          | MÃ¡y chá»§ gá»‘c á»Ÿ táº§ng cao nháº¥t cá»§a há»‡ thá»‘ng DNS.                         | CÃ³ 13 mÃ¡y chá»§ gá»‘c (Aâ€“M): `a.root-servers.net`             |
  | **TLD Name Server**           | MÃ¡y chá»§ quáº£n lÃ½ cÃ¡c tÃªn miá»n cáº¥p cao (TLD) nhÆ° `.com`, `.org`.        | Verisign quáº£n lÃ½ `.com`, PIR quáº£n lÃ½ `.org`               |
  | **Authoritative Name Server** | MÃ¡y chá»§ chá»©a báº£n ghi IP thá»±c sá»± cá»§a tÃªn miá»n.                         | ThÆ°á»ng do nhÃ  cung cáº¥p hosting hoáº·c registrar quáº£n lÃ½.    |
  | **DNS Record Types**          | CÃ¡c loáº¡i báº£n ghi DNS lÆ°u thÃ´ng tin khÃ¡c nhau.                         | `A`, `AAAA`, `CNAME`, `MX`, `NS`, `TXT`, ...              |

| **Record Type** | **Full Name**             | **Description**                                                                                      | **Zone File Example**                                                                        |
| --------------- | ------------------------- | ---------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- |
| **A**           | Address Record            | Ãnh xáº¡ tÃªn miá»n (hostname) sang Ä‘á»‹a chá»‰ **IPv4**.                                                    | `www.example.com. IN A 192.0.2.1`                                                            |
| **AAAA**        | IPv6 Address Record       | Ãnh xáº¡ tÃªn miá»n sang Ä‘á»‹a chá»‰ **IPv6**.                                                               | `www.example.com. IN AAAA 2001:db8:85a3::8a2e:370:7334`                                      |
| **CNAME**       | Canonical Name Record     | Táº¡o **bÃ­ danh (alias)** cho hostname, trá» Ä‘áº¿n hostname khÃ¡c.                                         | `blog.example.com. IN CNAME webserver.example.net.`                                          |
| **MX**          | Mail Exchange Record      | XÃ¡c Ä‘á»‹nh **mÃ¡y chá»§ mail** chá»‹u trÃ¡ch nhiá»‡m nháº­n email cho tÃªn miá»n.                                  | `example.com. IN MX 10 mail.example.com.`                                                    |
| **NS**          | Name Server Record        | á»¦y quyá»n quáº£n lÃ½ vÃ¹ng DNS cho **mÃ¡y chá»§ tÃªn miá»n (name server)** cá»¥ thá»ƒ.                             | `example.com. IN NS ns1.example.com.`                                                        |
| **TXT**         | Text Record               | LÆ°u **chuá»—i vÄƒn báº£n tÃ¹y Ã½**, thÆ°á»ng dÃ¹ng cho xÃ¡c minh tÃªn miá»n hoáº·c chÃ­nh sÃ¡ch báº£o máº­t (SPF, DKIMâ€¦). | `example.com. IN TXT "v=spf1 mx -all"`                                                       |
| **SOA**         | Start of Authority Record | Chá»©a thÃ´ng tin quáº£n trá»‹ vÃ¹ng DNS (mÃ¡y chá»§ chÃ­nh, email quáº£n trá»‹, sá»‘ serial, TTLâ€¦).                   | `example.com. IN SOA ns1.example.com. admin.example.com. 2024060301 10800 3600 604800 86400` |
| **SRV**         | Service Record            | XÃ¡c Ä‘á»‹nh **mÃ¡y chá»§ vÃ  cá»•ng dá»‹ch vá»¥** cho á»©ng dá»¥ng cá»¥ thá»ƒ (nhÆ° SIP, LDAPâ€¦).                           | `_sip._udp.example.com. IN SRV 10 5 5060 sipserver.example.com.`                             |
| **PTR**         | Pointer Record            | DÃ¹ng cho **tra cá»©u ngÆ°á»£c (reverse lookup)**: Ã¡nh xáº¡ **Ä‘á»‹a chá»‰ IP â†’ tÃªn miá»n**.                       | `1.2.0.192.in-addr.arpa. IN PTR www.example.com.`                                            |

The "IN" in the examples stands for "Internet." It's a class field in DNS records that specifies the protocol family. In most cases, you'll see "IN" used, as it denotes the Internet protocol suite (IP) used for most domain names. Other class values exist (e.g., CH for Chaosnet, HS for Hesiod) but are rarely used in modern DNS configurations.
In essence, "IN" is simply a convention that indicates that the record applies to the standard internet protocols we use today. While it might seem like an extra detail, understanding its meaning provides a deeper understanding of DNS record structure.

Why DNS Matters for Web Recon
DNS is not merely a technical protocol for translating domain names; it's a critical component of a target's infrastructure that can be leveraged to uncover vulnerabilities and gain access during a penetration test:
Uncovering Assets: DNS records can reveal a wealth of information, including subdomains, mail servers, and name server records. For instance, a CNAME record pointing to an outdated server (dev.example.com CNAME oldserver.example.net) could lead to a vulnerable system.
Mapping the Network Infrastructure: You can create a comprehensive map of the target's network infrastructure by analysing DNS data. For example, identifying the name servers (NS records) for a domain can reveal the hosting provider used, while an A record for loadbalancer.example.com can pinpoint a load balancer. This helps you understand how different systems are connected, identify traffic flow, and pinpoint potential choke points or weaknesses that could be exploited during a penetration test.
Monitoring for Changes: Continuously monitoring DNS records can reveal changes in the target's infrastructure over time. For example, the sudden appearance of a new subdomain (vpn.example.com) might indicate a new entry point into the network, while a TXT record containing a value like _1password=... strongly suggests the organization is using 1Password, which could be leveraged for social engineering attacks or targeted phishing campaigns.




====================================================================== Digging DNS ======================================================================
====================================================================== Digging DNS ======================================================================
====================================================================== Digging DNS ======================================================================

Digging DNS
Having established a solid understanding of DNS fundamentals and its various record types, let's now transition to the practical. This section will explore the tools and techniques for leveraging DNS for web reconnaissance.

DNS Tools
DNS reconnaissance involves utilizing specialized tools designed to query DNS servers and extract valuable information. Here are some of the most popular and versatile tools in the arsenal of web recon professionals:

| **Tool**                       | **Key Features**                                                                                     | **Use Cases**                                                                                                               |
| ------------------------------ | ---------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| **dig**                        | CÃ´ng cá»¥ tra cá»©u DNS máº¡nh máº½, há»— trá»£ nhiá»u loáº¡i truy váº¥n (A, MX, NS, TXT, v.v.) vÃ  hiá»ƒn thá»‹ chi tiáº¿t. | Thá»±c hiá»‡n truy váº¥n DNS thá»§ cÃ´ng, kiá»ƒm tra zone transfer (náº¿u Ä‘Æ°á»£c phÃ©p), kháº¯c phá»¥c sá»± cá»‘ DNS, phÃ¢n tÃ­ch chuyÃªn sÃ¢u báº£n ghi. |
| **nslookup**                   | CÃ´ng cá»¥ tra cá»©u DNS Ä‘Æ¡n giáº£n, chá»§ yáº¿u há»— trá»£ báº£n ghi A, AAAA vÃ  MX.                                  | Kiá»ƒm tra nhanh tÃªn miá»n, tra cá»©u cÆ¡ báº£n vá» phÃ¢n giáº£i tÃªn miá»n hoáº·c mÃ¡y chá»§ mail.                                            |
| **host**                       | CÃ´ng cá»¥ tra cá»©u DNS gá»n nháº¹ vá»›i káº¿t quáº£ ngáº¯n gá»n.                                                    | Kiá»ƒm tra nhanh báº£n ghi A, AAAA, MX.                                                                                         |
| **dnsenum**                    | Tá»± Ä‘á»™ng liá»‡t kÃª DNS, há»— trá»£ táº¥n cÃ´ng tá»« Ä‘iá»ƒn, brute force, vÃ  zone transfer (náº¿u Ä‘Æ°á»£c phÃ©p).         | PhÃ¡t hiá»‡n subdomain vÃ  thu tháº­p thÃ´ng tin DNS tá»± Ä‘á»™ng.                                                                      |
| **fierce**                     | CÃ´ng cá»¥ trinh sÃ¡t DNS vÃ  liá»‡t kÃª subdomain, há»— trá»£ tÃ¬m kiáº¿m Ä‘á»‡ quy vÃ  phÃ¡t hiá»‡n wildcard.            | Dá»… sá»­ dá»¥ng cho reconnaissance DNS, xÃ¡c Ä‘á»‹nh subdomain vÃ  má»¥c tiÃªu tiá»m nÄƒng.                                                |
| **dnsrecon**                   | Káº¿t há»£p nhiá»u ká»¹ thuáº­t trinh sÃ¡t DNS, há»— trá»£ nhiá»u Ä‘á»‹nh dáº¡ng xuáº¥t káº¿t quáº£.                           | Liá»‡t kÃª DNS toÃ n diá»‡n, phÃ¡t hiá»‡n subdomain, thu tháº­p báº£n ghi DNS Ä‘á»ƒ phÃ¢n tÃ­ch sÃ¢u.                                          |
| **theHarvester**               | CÃ´ng cá»¥ OSINT thu tháº­p thÃ´ng tin tá»« nhiá»u nguá»“n, bao gá»“m báº£n ghi DNS vÃ  email.                       | Thu tháº­p email, thÃ´ng tin nhÃ¢n viÃªn vÃ  dá»¯ liá»‡u liÃªn quan Ä‘áº¿n tÃªn miá»n tá»« nhiá»u nguá»“n khÃ¡c nhau.                             |
| **Online DNS Lookup Services** | Giao diá»‡n thÃ¢n thiá»‡n ngÆ°á»i dÃ¹ng Ä‘á»ƒ thá»±c hiá»‡n tra cá»©u DNS trá»±c tuyáº¿n.                                 | Tra cá»©u DNS nhanh chÃ³ng, kiá»ƒm tra tÃªn miá»n, tra cá»©u khi khÃ´ng cÃ³ cÃ´ng cá»¥ dÃ²ng lá»‡nh.                                         |


The Domain Information Groper
The dig command (Domain Information Groper) is a versatile and powerful utility for querying DNS servers and retrieving various types of DNS records. Its flexibility and detailed and customizable output make it a go-to choice.

Common dig Commands
| **Command**                     | **Description**                                                                                                      |
| ------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| `dig domain.com`                | Thá»±c hiá»‡n truy váº¥n máº·c Ä‘á»‹nh Ä‘á»ƒ láº¥y báº£n ghi **A** (Ä‘á»‹a chá»‰ IPv4) cá»§a tÃªn miá»n.                                        |
| `dig domain.com A`              | Láº¥y **Ä‘á»‹a chá»‰ IPv4 (A record)** liÃªn káº¿t vá»›i tÃªn miá»n.                                                               |
| `dig domain.com AAAA`           | Láº¥y **Ä‘á»‹a chá»‰ IPv6 (AAAA record)** cá»§a tÃªn miá»n.                                                                     |
| `dig domain.com MX`             | TÃ¬m cÃ¡c **mÃ¡y chá»§ mail (MX records)** cá»§a tÃªn miá»n.                                                                  |
| `dig domain.com NS`             | XÃ¡c Ä‘á»‹nh **cÃ¡c mÃ¡y chá»§ tÃªn miá»n (Name Servers)** cÃ³ tháº©m quyá»n cho domain.                                           |
| `dig domain.com TXT`            | Láº¥y cÃ¡c **báº£n ghi TXT**, thÆ°á»ng chá»©a thÃ´ng tin xÃ¡c minh hoáº·c chÃ­nh sÃ¡ch SPF/DKIM.                                    |
| `dig domain.com CNAME`          | Láº¥y **báº£n ghi CNAME** (tÃªn miá»n bÃ­ danh) cá»§a domain.                                                                 |
| `dig domain.com SOA`            | Láº¥y **báº£n ghi SOA (Start of Authority)** â€“ thÃ´ng tin quáº£n trá»‹ cá»§a vÃ¹ng DNS.                                          |
| `dig @1.1.1.1 domain.com`       | Chá»‰ Ä‘á»‹nh **mÃ¡y chá»§ DNS cá»¥ thá»ƒ** Ä‘á»ƒ truy váº¥n (á»Ÿ Ä‘Ã¢y lÃ  Cloudflare `1.1.1.1`).                                         |
| `dig +trace domain.com`         | Hiá»ƒn thá»‹ **toÃ n bá»™ quÃ¡ trÃ¬nh phÃ¢n giáº£i DNS**, tá»« Root â†’ TLD â†’ Authoritative.                                         |
| `dig -x 192.168.1.1`            | Thá»±c hiá»‡n **tra cá»©u ngÆ°á»£c (reverse lookup)** Ä‘á»ƒ tÃ¬m tÃªn miá»n tá»« Ä‘á»‹a chá»‰ IP.                                          |
| `dig +short domain.com`         | Hiá»ƒn thá»‹ **káº¿t quáº£ ngáº¯n gá»n**, chá»‰ gá»“m pháº§n tráº£ lá»i chÃ­nh.                                                           |
| `dig +noall +answer domain.com` | Chá»‰ hiá»ƒn thá»‹ **pháº§n â€œanswer sectionâ€** cá»§a káº¿t quáº£.                                                                  |
| `dig domain.com ANY`            | Láº¥y **táº¥t cáº£ cÃ¡c báº£n ghi DNS** cÃ³ sáºµn cho domain *(lÆ°u Ã½: nhiá»u DNS server hiá»‡n bá» qua truy váº¥n ANY theo RFC 8482)*. |

Caution: Some servers can detect and block excessive DNS queries. Use caution and respect rate limits. Always obtain permission before performing extensive DNS reconnaissance on a target.

Groping DNS
  naruto3co@htb[/htb]$ dig google.com
      ; <<>> DiG 9.18.24-0ubuntu0.22.04.1-Ubuntu <<>> google.com
      ;; global options: +cmd
      ;; Got answer:
      ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 16449
      ;; flags: qr rd ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0
      ;; WARNING: recursion requested but not available
      
      ;; QUESTION SECTION:
      ;google.com.                    IN      A
      
      ;; ANSWER SECTION:
      google.com.             0       IN      A       142.251.47.142
      
      ;; Query time: 0 msec
      ;; SERVER: 172.23.176.1#53(172.23.176.1) (UDP)
      ;; WHEN: Thu Jun 13 10:45:58 SAST 2024
      ;; MSG SIZE  rcvd: 54


This output is the result of a DNS query using the dig command for the domain google.com. The command was executed on a system running DiG version 9.18.24-0ubuntu0.22.04.1-Ubuntu. The output can be broken down into four key sections:
  Header
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 16449: This line indicates the type of query (QUERY), the successful status (NOERROR), and a unique identifier (16449) for this specific query.
      ;; flags: qr rd ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0: This describes the flags in the DNS header:
      qr: Query Response flag - indicates this is a response.
      rd: Recursion Desired flag - means recursion was requested.
      ad: Authentic Data flag - means the resolver considers the data authentic.
      The remaining numbers indicate the number of entries in each section of the DNS response: 1 question, 1 answer, 0 authority records, and 0 additional records.
    ;; WARNING: recursion requested but not available: This indicates that recursion was requested, but the server does not support it.
  

Question Section
  ;google.com. IN A: This line specifies the question: "What is the IPv4 address (A record) for google.com?"
Answer Section
  google.com. 0 IN A 142.251.47.142: This is the answer to the query. It indicates that the IP address associated with google.com is 142.251.47.142. The '0' represents the TTL (time-to-live), indicating how long the result can be cached before being refreshed.
Footer
  ;; Query time: 0 msec: This shows the time it took for the query to be processed and the response to be received (0 milliseconds).
  ;; SERVER: 172.23.176.1#53(172.23.176.1) (UDP): This identifies the DNS server that provided the answer and the protocol used (UDP).
  ;; WHEN: Thu Jun 13 10:45:58 SAST 2024: This is the timestamp of when the query was made.
  ;; MSG SIZE rcvd: 54: This indicates the size of the DNS message received (54 bytes).

An opt pseudosection can sometimes exist in a dig query. This is due to Extension Mechanisms for DNS (EDNS), which allows for additional features such as larger message sizes and DNS Security Extensions (DNSSEC) support.
If you just want the answer to the question, without any of the other information, you can query dig using +short:
    naruto3co@htb[/htb]$ dig +short hackthebox.com


====================================================================== Subdomains ======================================================================
====================================================================== Subdomains ======================================================================
====================================================================== Subdomains ======================================================================

Subdomain lÃ  pháº§n má»Ÿ rá»™ng cá»§a domain chÃ­nh, Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ phÃ¢n chia cÃ¡c chá»©c nÄƒng hoáº·c khu vá»±c cá»§a má»™t website (vÃ­ dá»¥: blog.example.com, shop.example.com, mail.example.com).
Táº§m quan trá»ng trong web reconnaissance:
  MÃ´i trÆ°á»ng phÃ¡t triá»ƒn / thá»­ nghiá»‡m (staging): thÆ°á»ng cÃ³ báº£o máº­t lá»ng láº»o, cÃ³ thá»ƒ chá»©a lá»— há»•ng hoáº·c thÃ´ng tin nháº¡y cáº£m.
  Cá»•ng Ä‘Äƒng nháº­p áº©n: cÃ³ thá»ƒ chá»©a cÃ¡c trang quáº£n trá»‹ hoáº·c login khÃ´ng Ä‘Æ°á»£c cÃ´ng khai, lÃ  má»¥c tiÃªu tiá»m nÄƒng cho káº» táº¥n cÃ´ng.
  á»¨ng dá»¥ng cÅ© (legacy): cÃ³ thá»ƒ váº«n hoáº¡t Ä‘á»™ng trÃªn subdomain vÃ  chá»©a pháº§n má»m lá»—i thá»i dá»… bá»‹ khai thÃ¡c.
  ThÃ´ng tin nháº¡y cáº£m: subdomain Ä‘Ã´i khi tiáº¿t lá»™ dá»¯ liá»‡u ná»™i bá»™, tÃ i liá»‡u, hoáº·c file cáº¥u hÃ¬nh quan trá»ng.

Äá»‹nh nghÄ©a ngáº¯n: Subdomain enumeration lÃ  quÃ¡ trÃ¬nh tÃ¬m vÃ  liá»‡t kÃª cÃ¡c miá»n phá»¥ (subdomains) cá»§a má»™t domain chÃ­nh â€” thÆ°á»ng thá»ƒ hiá»‡n qua báº£n ghi DNS A/AAAA (trá» tá»›i IP) hoáº·c CNAME (bÃ­ danh).
Loáº¡i báº£n ghi liÃªn quan:
	A / AAAA: Ã¡nh xáº¡ subdomain â†’ Ä‘á»‹a chá»‰ IP.
	CNAME: alias trá» tá»›i domain/subdomain khÃ¡c.
	PTR, TXT, SRV (Ã­t phá»• biáº¿n hÆ¡n) cÅ©ng cÃ³ thá»ƒ cung cáº¥p thÃ´ng tin bá»• sung.
Hai phÆ°Æ¡ng phÃ¡p chÃ­nh:
	Active (chá»§ Ä‘á»™ng):
		TÆ°Æ¡ng tÃ¡c trá»±c tiáº¿p vá»›i DNS server cá»§a má»¥c tiÃªu.
		Ká»¹ thuáº­t: thá»­ DNS zone transfer (AXFR) náº¿u server cáº¥u hÃ¬nh sai; brute-force tÃªn miá»n phá»¥ báº±ng wordlists.
		CÃ´ng cá»¥ máº«u: dnsenum, gobuster, ffuf, massdns, subfinder (káº¿t há»£p active checks).
		Æ¯u/nhÆ°á»£c: cÃ³ kháº£ nÄƒng Ä‘áº§y Ä‘á»§ hÆ¡n nhÆ°ng dá»… bá»‹ phÃ¡t hiá»‡n (log, IDS).
	Passive (thá»¥ Ä‘á»™ng):
		Sá»­ dá»¥ng nguá»“n dá»¯ liá»‡u cÃ´ng khai, khÃ´ng truy váº¥n trá»±c tiáº¿p DNS má»¥c tiÃªu.
		Nguá»“n: Certificate Transparency (CT) logs (SAN trong certs), search engines (site:), dá»‹ch vá»¥ táº­p há»£p DNS (VirusTotal, SecurityTrails, Shodan, Censys...), lá»‹ch sá»­ WHOIS, repo cÃ´ng khai.
		Æ¯u/nhÆ°á»£c: tháº§m láº·ng, an toÃ n vá» máº·t phÃ¡t hiá»‡n, nhÆ°ng cÃ³ thá»ƒ khÃ´ng Ä‘áº§y Ä‘á»§ / lá»—i thá»i.
Lá»i khuyÃªn chiáº¿n lÆ°á»£c:
	Káº¿t há»£p passive â†’ má»Ÿ rá»™ng báº±ng active Ä‘á»ƒ vá»«a giá»¯ stealth vá»«a tá»‘i Ä‘a hÃ³a Ä‘á»™ bao phá»§.
	DÃ¹ng wordlists tÃ¹y chá»‰nh (theo nghiá»‡p vá»¥/tiá»n tá»‘ ná»™i bá»™) Ä‘á»ƒ tÄƒng hiá»‡u quáº£ brute-force.
	LÆ°u láº¡i káº¿t quáº£, theo dÃµi thay Ä‘á»•i (subdomain takeover, expired DNS records).
Rá»§i ro/giÃ¡ trá»‹:
	hiá»‡n staging/dev, login/adm portals, á»©ng dá»¥ng cÅ©, hoáº·c tÃ i liá»‡u nháº¡y cáº£m trÃªn subdomains â€” táº¥t cáº£ Ä‘á»u cÃ³ giÃ¡ trá»‹ cho reconnaissance hoáº·c Ä‘á»ƒ vÃ¡ lá»— há»•ng.

dnsenum â€” CÃ´ng cá»¥ toÃ n diá»‡n, há»— trá»£ dictionary + brute-force.
  Khi dÃ¹ng: muá»‘n má»™t tool â€œall-in-oneâ€ dá»… cháº¡y nhanh cho reconnaissance cÆ¡ báº£n.
  Lá»‡nh máº«u: dnsenum --enum --threads 10 example.com

fierce â€” Dá»… dÃ¹ng, tá»‘t cho dÃ² Ä‘á»‡ quy vÃ  phÃ¡t hiá»‡n wildcard DNS.
  Khi dÃ¹ng: muá»‘n phÃ¡t hiá»‡n cáº¥u trÃºc subdomain theo kiá»ƒu Ä‘á»‡ quy/káº¿ thá»«a nhanh.
  Lá»‡nh máº«u: fierce -dns example.com

dnsrecon â€” Linh hoáº¡t, káº¿t há»£p nhiá»u ká»¹ thuáº­t (brute, zone transfer, reverse) vÃ  xuáº¥t Ä‘Æ°á»£c nhiá»u Ä‘á»‹nh dáº¡ng.
  Khi dÃ¹ng: khi cáº§n bÃ¡o cÃ¡o cÃ³ cáº¥u trÃºc (CSV/JSON) hoáº·c muá»‘n mix nhiá»u ká»¹ thuáº­t trong 1 tool.
  Lá»‡nh máº«u: dnsrecon -d example.com -a (all tests)

amass â€” Duy trÃ¬ tÃ­ch cá»±c, máº¡nh vá» má»©c Ä‘á»™ thu tháº­p (passive + active) vÃ  cÃ³ tÃ­ch há»£p nhiá»u nguá»“n/wordlists.
  Khi dÃ¹ng: khi cáº§n coverage cao, káº¿t há»£p CT logs, API, brute, graph mapping.
  Lá»‡nh máº«u: amass enum -d example.com -o amass.txt

assetfinder â€” Nháº¹, nhanh, hiá»‡u quáº£ cho bÆ°á»›c thu tháº­p nhanh tá»« nhiá»u nguá»“n cÃ´ng khai.
  Khi dÃ¹ng: lÃºc báº¯t Ä‘áº§u reconnaissance, muá»‘n nhanh cÃ³ danh sÃ¡ch ban Ä‘áº§u.
  Lá»‡nh máº«u: assetfinder --subs-only example.com

puredns â€” Ráº¥t tá»‘t cho brute-force + resolving hÃ ng loáº¡t (tá»‘c Ä‘á»™ cao), phÃ¹ há»£p khi báº¡n Ä‘Ã£ cÃ³ wordlist lá»›n.
  Khi dÃ¹ng: khi cháº¡y brute-force scale lá»›n, káº¿t há»£p vá»›i massresolver hoáº·c custom resolver.
  Lá»‡nh máº«u: puredns bruteforce wordlist.txt example.com --r 8.8.8.8 | puredns resolve -w results.txt

Gá»£i Ã½ chiáº¿n lÆ°á»£c káº¿t há»£p (ngáº¯n)
    Passive first: assetfinder â†’ amass (passive) â†’ CT logs â†’ dedupe.
    Tá»‘i Æ°u wordlist: tá»•ng há»£p tá»« káº¿t quáº£ passive â†’ thÃªm targeted words.
    Brute/resolution: dÃ¹ng puredns (hoáº·c massdns) trÃªn wordlist Ä‘Ã£ tinh chá»‰nh.
    XÃ¡c thá»±c & mapping: amass + dnsrecon Ä‘á»ƒ kiá»ƒm tra ká»¹, xuáº¥t JSON/CSV cho bÃ¡o cÃ¡o.
    Wildcard check: luÃ´n test wildcard DNS trÆ°á»›c (vÃ­ dá»¥ vá»›i má»™t tÃªn ngáº«u nhiÃªn) Ä‘á»ƒ loáº¡i false-positive.

https://github.com/danielmiessler/SecLists




====================================================================== DNS Zone Transfers ======================================================================
====================================================================== DNS Zone Transfers ======================================================================
====================================================================== DNS Zone Transfers ======================================================================



While brute-forcing can be a fruitful approach, there's a less invasive and potentially more efficient method for uncovering subdomains â€“ DNS zone transfers. This mechanism, designed for replicating DNS records between name servers, can inadvertently become a goldmine of information for prying eyes if misconfigured.
What is a Zone Transfer
A DNS zone transfer is essentially a wholesale copy of all DNS records within a zone (a domain and its subdomains) from one name server to another. This process is essential for maintaining consistency and redundancy across DNS servers. However, if not adequately secured, unauthorised parties can download the entire zone file, revealing a complete list of subdomains, their associated IP addresses, and other sensitive DNS data.


+--------------------+                          +--------------------+
| secondaryServer    |                          | primaryServer      |
+--------------------+                          +--------------------+
       |                                            |
       |  ---------------- AXFR Request ---------->|
       |                                            |
       |  <--------------- SOA Record --------------|
       |                                            |
       |  <---+                                    |
       |      |  [ transfer ]                       |
       |      |  +---------------------------------+
       |      |  | DNS Record: example.inlane ...  |
       |      |  | DNS Record: www.inlane ...      |
       |      |  | DNS Record: mail.inlane ...     |
       |      |  | ... (loop / many records)       |
       |      |  +---------------------------------+
       |  <---+                                    |
       |                                            |
       |  <---------- Zone Transfer Complete ------|
       |                                            |
       |  ------------------- ACK ---------------->|
       |                                            |
+--------------------+                          +--------------------+
| secondaryServer    |                          | primaryServer      |
+--------------------+                          +--------------------+

Zone Transfer Request (AXFR): The secondary DNS server initiates the process by sending a zone transfer request to the primary server. This request typically uses the AXFR (Full Zone Transfer) type.
SOA Record Transfer: Upon receiving the request (and potentially authenticating the secondary server), the primary server responds by sending its Start of Authority (SOA) record. The SOA record contains vital information about the zone, including its serial number, which helps the secondary server determine if its zone data is current.
DNS Records Transmission: The primary server then transfers all the DNS records in the zone to the secondary server, one by one. This includes records like A, AAAA, MX, CNAME, NS, and others that define the domain's subdomains, mail servers, name servers, and other configurations.
Zone Transfer Complete: Once all records have been transmitted, the primary server signals the end of the zone transfer. This notification informs the secondary server that it has received a complete copy of the zone data.
Acknowledgement (ACK): The secondary server sends an acknowledgement message to the primary server, confirming the successful receipt and processing of the zone data. This completes the zone transfer process.


The Zone Transfer Vulnerability
	While zone transfers are essential for legitimate DNS management, a misconfigured DNS server can transform this process into a significant security vulnerability. The core issue lies in the access controls governing who can initiate a zone transfer.
	In the early days of the internet, allowing any client to request a zone transfer from a DNS server was common practice. This open approach simplified administration but opened a gaping security hole. It meant that anyone, including malicious actors, could ask a DNS server for a complete copy of its zone file, which contains a wealth of sensitive information.
	The information gleaned from an unauthorised zone transfer can be invaluable to an attacker. It reveals a comprehensive map of the target's DNS infrastructure, including:
	Subdomains: A complete list of subdomains, many of which might not be linked from the main website or easily discoverable through other means. These hidden subdomains could host development servers, staging environments, administrative panels, or other sensitive resources.
	IP Addresses: The IP addresses associated with each subdomain, providing potential targets for further reconnaissance or attacks.
	Name Server Records: Details about the authoritative name servers for the domain, revealing the hosting provider and potential misconfigurations.

Remediation
	Fortunately, awareness of this vulnerability has grown, and most DNS server administrators have mitigated the risk. Modern DNS servers are typically configured to allow zone transfers only to trusted secondary servers, ensuring that sensitive zone data remains confidential.
	However, misconfigurations can still occur due to human error or outdated practices. This is why attempting a zone transfer (with proper authorisation) remains a valuable reconnaissance technique. Even if unsuccessful, the attempt can reveal information about the DNS server's configuration and security posture.

Exploiting Zone Transfers
	You can use the dig command to request a zone transfer:
		naruto3co@htb[/htb]$ dig axfr @nsztm1.digi.ninja zonetransfer.me

This command instructs dig to request a full zone transfer (axfr) from the DNS server responsible for zonetransfer.me. If the server is misconfigured and allows the transfer, you'll receive a complete list of DNS records for the domain, including all subdomains.
		naruto3co@htb[/htb]$ dig axfr @nsztm1.digi.ninja zonetransfer.me
		
				; <<>> DiG 9.18.12-1~bpo11+1-Debian <<>> axfr @nsztm1.digi.ninja zonetransfer.me
				; (1 server found)
				;; global options: +cmd
				zonetransfer.me.	7200	IN	SOA	nsztm1.digi.ninja. robin.digi.ninja. 2019100801 172800 900 1209600 3600
				zonetransfer.me.	300	IN	HINFO	"Casio fx-700G" "Windows XP"
				zonetransfer.me.	301	IN	TXT	"google-site-verification=tyP28J7JAUHA9fw2sHXMgcCC0I6XBmmoVi04VlMewxA"
				zonetransfer.me.	7200	IN	MX	0 ASPMX.L.GOOGLE.COM.
				...
				zonetransfer.me.	7200	IN	A	5.196.105.14
				zonetransfer.me.	7200	IN	NS	nsztm1.digi.ninja.
				zonetransfer.me.	7200	IN	NS	nsztm2.digi.ninja.
				_acme-challenge.zonetransfer.me. 301 IN	TXT	"6Oa05hbUJ9xSsvYy7pApQvwCUSSGgxvrbdizjePEsZI"
				_sip._tcp.zonetransfer.me. 14000 IN	SRV	0 0 5060 www.zonetransfer.me.
				14.105.196.5.IN-ADDR.ARPA.zonetransfer.me. 7200	IN PTR www.zonetransfer.me.
				asfdbauthdns.zonetransfer.me. 7900 IN	AFSDB	1 asfdbbox.zonetransfer.me.
				asfdbbox.zonetransfer.me. 7200	IN	A	127.0.0.1
				asfdbvolume.zonetransfer.me. 7800 IN	AFSDB	1 asfdbbox.zonetransfer.me.
				canberra-office.zonetransfer.me. 7200 IN A	202.14.81.230
				...
				;; Query time: 10 msec
				;; SERVER: 81.4.108.41#53(nsztm1.digi.ninja) (TCP)
				;; WHEN: Mon May 27 18:31:35 BST 2024
				;; XFR size: 50 records (messages 1, bytes 2085)


====================================================================== Virtual Hosts ======================================================================
====================================================================== Virtual Hosts ======================================================================
====================================================================== Virtual Hosts ======================================================================

Once the DNS directs traffic to the correct server, the web server configuration becomes crucial in determining how the incoming requests are handled. Web servers like Apache, Nginx, or IIS are designed to host multiple websites or applications on a single server. They achieve this through virtual hosting, which allows them to differentiate between domains, subdomains, or even separate websites with distinct content.

How Virtual Hosts Work: Understanding VHosts and Subdomains
At the core of virtual hosting is the ability of web servers to distinguish between multiple websites or applications sharing the same IP address. This is achieved by leveraging the HTTP Host header, a piece of information included in every HTTP request sent by a web browser.

The key difference between VHosts and subdomains is their relationship to the Domain Name System (DNS) and the web server's configuration.
	Subdomains: These are extensions of a main domain name (e.g., blog.example.com is a subdomain of example.com). Subdomains typically have their own DNS records, pointing to either the same IP address as the main domain or a different one. They can be used to organise different sections or services of a website.
	Virtual Hosts (VHosts): Virtual hosts are configurations within a web server that allow multiple websites or applications to be hosted on a single server. They can be associated with top-level domains (e.g., example.com) or subdomains (e.g., dev.example.com). Each virtual host can have its own separate configuration, enabling precise control over how requests are handled.

Subdomain (tÃªn miá»n con) â†’ lÃ  pháº§n má»Ÿ rá»™ng cá»§a tÃªn miá»n chÃ­nh.
â†’ Quáº£n lÃ½ á»Ÿ DNS.
â†’ VÃ­ dá»¥: blog.example.com hoáº·c shop.example.com.
â†’ Má»—i subdomain cÃ³ thá»ƒ trá» tá»›i cÃ¹ng hoáº·c khÃ¡c IP so vá»›i domain chÃ­nh.

Virtual Host (VHost) â†’ lÃ  cáº¥u hÃ¬nh trong web server (Apache/Nginx) Ä‘á»ƒ phÃ¢n biá»‡t nhiá»u website cháº¡y trÃªn má»™t mÃ¡y chá»§ duy nháº¥t.
â†’ Quáº£n lÃ½ á»Ÿ má»©c web server, khÃ´ng pháº£i DNS.
â†’ VÃ­ dá»¥: cÃ¹ng má»™t server cÃ³ thá»ƒ host cáº£ example.com vÃ  shop.example.com qua 2 file cáº¥u hÃ¬nh VHost riÃªng.

VÃ­ dá»¥ tá»•ng há»£p:
blog.example.com â†’ lÃ  subdomain (Ä‘Æ°á»£c khai bÃ¡o trong DNS).
Web server cÃ³ file cáº¥u hÃ¬nh:
	server {
	    server_name blog.example.com;
	    root /var/www/blog;
	}
â†’ Ä‘Ã¢y lÃ  Virtual Host xá»­ lÃ½ cho subdomain Ä‘Ã³.
ğŸ‘‰ TÃ³m láº¡i:
	Subdomain: thuá»™c vá» DNS.
	VHost: thuá»™c vá» cáº¥u hÃ¬nh web server.

If a virtual host does not have a DNS record, you can still access it by modifying the hosts file on your local machine. The hosts file allows you to map a domain name to an IP address manually, bypassing DNS resolution.
Websites often have subdomains that are not public and won't appear in DNS records. These subdomains are only accessible internally or through specific configurations. VHost fuzzing is a technique to discover public and non-public subdomains and VHosts by testing various hostnames against a known IP address.
Virtual hosts can also be configured to use different domains, not just subdomains. For example:
# Example of name-based virtual host configuration in Apache
	<VirtualHost *:80>
	    ServerName www.example1.com
	    DocumentRoot /var/www/example1
	</VirtualHost>
	<VirtualHost *:80>
	    ServerName www.example2.org
	    DocumentRoot /var/www/example2
	</VirtualHost>
	<VirtualHost *:80>
	    ServerName www.another-example.net
	    DocumentRoot /var/www/another-example
	</VirtualHost>

Here, example1.com, example2.org, and another-example.net are distinct domains hosted on the same server. The web server uses the Host header to serve the appropriate content based on the requested domain name.

Browser                         WebServer                    VirtualHostConfig                 DocumentRoot
   |                                 |                                |                               |
   |-- HTTP Request (www.inlanefreight.com) -->                       |                               |
   |                                 |                                |                               |
   |                                 |-- Examine Host Header -------->|                               |
   |                                 |<-- Finding Matching Config ----|                               |
   |                                 |                                |                               |
   |                                 |--------> Return Document Root -------------------------------> |
   |                                 |<-------------------------------- Retrieve Files and Resources -|
   |                                 |                                |                               |
   |<---------------------------- HTTP Response -----------------------|                               |
   |-- Display Content ------------->|                                |                               |
   |                                 |                                |                               |

Browser Requests a Website: When you enter a domain name (e.g., www.inlanefreight.com) into your browser, it initiates an HTTP request to the web server associated with that domain's IP address.
Host Header Reveals the Domain: The browser includes the domain name in the request's Host header, which acts as a label to inform the web server which website is being requested.
Web Server Determines the Virtual Host: The web server receives the request, examines the Host header, and consults its virtual host configuration to find a matching entry for the requested domain name.
Serving the Right Content: Upon identifying the correct virtual host configuration, the web server retrieves the corresponding files and resources associated with that website from its document root and sends them back to the browser as the HTTP response.

In essence, the Host header functions as a switch, enabling the web server to dynamically determine which website to serve based on the domain name requested by the browser.

Types of Virtual Hosting
There are three primary types of virtual hosting, each with its advantages and drawbacks:
	Name-Based Virtual Hosting: This method relies solely on the HTTP Host header to distinguish between websites. It is the most common and flexible method, as it doesn't require multiple IP addresses. Itâ€™s cost-effective, easy to set up, and supports most modern web servers. However, it requires the web server to support name-based virtual hosting and can have limitations with certain protocols like SSL/TLS.
	IP-Based Virtual Hosting: This type of hosting assigns a unique IP address to each website hosted on the server. The server determines which website to serve based on the IP address to which the request was sent. It doesn't rely on the Host header, can be used with any protocol, and offers better isolation between websites. Still, it requires multiple IP addresses, which can be expensive and less scalable.
	Port-Based Virtual Hosting: Different websites are associated with different ports on the same IP address. For example, one website might be accessible on port 80, while another is on port 8080. Port-based virtual hosting can be used when IP addresses are limited, but itâ€™s not as common or user-friendly as name-based virtual hosting and might require users to specify the port number in the URL.

| Loáº¡i Virtual Hosting | CÃ¡ch hoáº¡t Ä‘á»™ng                                                | Æ¯u Ä‘iá»ƒm                                          | NhÆ°á»£c Ä‘iá»ƒm                                         | VÃ­ dá»¥                                                   |
| -------------------- | ------------------------------------------------------------- | ------------------------------------------------ | -------------------------------------------------- | ------------------------------------------------------- |
| **Name-Based**       | PhÃ¢n biá»‡t website dá»±a vÃ o **Host header** trong HTTP request. | Tiáº¿t kiá»‡m IP, dá»… cáº¥u hÃ¬nh, phá»• biáº¿n nháº¥t.        | CÃ³ thá»ƒ gáº·p váº¥n Ä‘á» vá»›i **SSL/TLS** (náº¿u server cÅ©). | `example.com` vÃ  `shop.example.com` cÃ¹ng IP.            |
| **IP-Based**         | Má»—i website cÃ³ **Ä‘á»‹a chá»‰ IP riÃªng**.                          | CÃ¡ch ly tá»‘t, dÃ¹ng Ä‘Æ°á»£c má»i giao thá»©c (SSL/TLSâ€¦). | Tá»‘n nhiá»u IP, khÃ³ má»Ÿ rá»™ng, chi phÃ­ cao.            | `example.com` â†’ 192.168.1.10, `shop.com` â†’ 192.168.1.11 |
| **Port-Based**       | CÃ¡c website dÃ¹ng **cá»•ng khÃ¡c nhau** trÃªn cÃ¹ng IP.             | KhÃ´ng cáº§n nhiá»u IP, dÃ¹ng khi thiáº¿u Ä‘á»‹a chá»‰ IP.   | KhÃ´ng thÃ¢n thiá»‡n (pháº£i gÃµ port), Ã­t phá»• biáº¿n.      | `example.com:80`, `example.com:8080`                    |
ğŸ‘‰ TÃ³m láº¡i:
	ThÆ°á»ng dÃ¹ng nháº¥t lÃ  Name-Based (hiá»‡n Ä‘áº¡i, linh hoáº¡t).
	IP-Based dÃ¹ng cho mÃ´i trÆ°á»ng cáº§n tÃ¡ch biá»‡t cao hoáº·c SSL riÃªng biá»‡t.
	Port-Based chá»‰ dÃ¹ng khi thá»±c sá»± cáº§n.


Virtual Host Discovery Tools
While manual analysis of HTTP headers and reverse DNS lookups can be effective, specialised virtual host discovery tools automate and streamline the process, making it more efficient and comprehensive. These tools employ various techniques to probe the target server and uncover potential virtual hosts.
| Tool            | MÃ´ táº£                                                                                                        | TÃ­nh nÄƒng                                                           |
| --------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------- |
| **gobuster**    | CÃ´ng cá»¥ Ä‘a nÄƒng thÆ°á»ng dÃ¹ng Ä‘á»ƒ brute-force thÆ° má»¥c/tá»‡p, Ä‘á»“ng thá»i hiá»‡u quáº£ cho viá»‡c phÃ¡t hiá»‡n virtual hosts. | Nhanh; há»— trá»£ nhiá»u phÆ°Æ¡ng thá»©c HTTP; dÃ¹ng Ä‘Æ°á»£c wordlist tÃ¹y chá»‰nh. |
| **Feroxbuster** | TÆ°Æ¡ng tá»± Gobuster nhÆ°ng viáº¿t báº±ng Rust, ná»•i báº­t vá» tá»‘c Ä‘á»™ vÃ  Ä‘á»™ linh hoáº¡t.                                   | Há»— trá»£ Ä‘á»‡ quy; phÃ¡t hiá»‡n wildcard; nhiá»u bá»™ lá»c; hiá»‡u nÄƒng cao.     |
| **ffuf**        | TrÃ¬nh web fuzzer nhanh, cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ phÃ¡t hiá»‡n virtual hosts báº±ng cÃ¡ch fuzz `Host` header.                 | Nháº­p wordlist tÃ¹y chá»‰nh; nhiá»u tÃ¹y chá»n lá»c vÃ  xá»­ lÃ½ káº¿t quáº£.       |

	naruto3co@htb[/htb]$ gobuster vhost -u http://<target_IP_address> -w <wordlist_file> --append-domain
	naruto3co@htb[/htb]$ gobuster vhost -u http://inlanefreight.htb:81 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --append-domain

Remember: to brute-force vhosts, you'll need to fuzz the host header, NOT the hostname. I'm partial to using ffuf for vhost fuzzing myself. You just run it against your wordlist of choice and add the -H 'Host: FUZZ.inlanefreight.htb' flag. Good luck and happy hunting!

-> bÃ i lab cÃ¢u 1 
CÃ¢u 1
	ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt \
     -u http://94.237.48.12:34589/ \
     -H "Host: FUZZ.inlanefreight.htb" \
     -t 50 \
     -mc 200 \
     -o ffuf_vhosts.json -of json

		-> web17611.inlanefreight.htb
CÃ¢u 2 : vm5.inlanefreight.htb


====================================================================== Certificate Transparency Logs ======================================================================
====================================================================== Certificate Transparency Logs ======================================================================
====================================================================== Certificate Transparency Logs ======================================================================

CT lÃ  sá»• cÃ¡i ghi chá»©ng chá»‰ 

In the sprawling mass of the internet, trust is a fragile commodity. One of the cornerstones of this trust is the Secure Sockets Layer/Transport Layer Security (SSL/TLS) protocol, which encrypts communication between your browser and a website. At the heart of SSL/TLS lies the digital certificate, a small file that verifies a website's identity and allows for secure, encrypted communication.
However, the process of issuing and managing these certificates isn't foolproof. Attackers can exploit rogue or mis-issued certificates to impersonate legitimate websites, intercept sensitive data, or spread malware. This is where Certificate Transparency (CT) logs come into play.

What are Certificate Transparency Logs?
Certificate Transparency (CT) logs are public, append-only ledgers that record the issuance of SSL/TLS certificates. Whenever a Certificate Authority (CA) issues a new certificate, it must submit it to multiple CT logs. Independent organisations maintain these logs and are open for anyone to inspect.
Think of CT logs as a global registry of certificates. They provide a transparent and verifiable record of every SSL/TLS certificate issued for a website. This transparency serves several crucial purposes:
	Early Detection of Rogue Certificates: By monitoring CT logs, security researchers and website owners can quickly identify suspicious or misissued certificates. A rogue certificate is an unauthorized or fraudulent digital certificate issued by a trusted certificate authority. Detecting these early allows for swift action to revoke the certificates before they can be used for malicious purposes.
	Accountability for Certificate Authorities: CT logs hold CAs accountable for their issuance practices. If a CA issues a certificate that violates the rules or standards, it will be publicly visible in the logs, leading to potential sanctions or loss of trust.
	Strengthening the Web PKI (Public Key Infrastructure): The Web PKI is the trust system underpinning secure online communication. CT logs help to enhance the security and integrity of the Web PKI by providing a mechanism for public oversight and verification of certificates.

How Certificate Transparency Logs Work
Certificate Transparency logs rely on a clever combination of cryptographic techniques and public accountability:
	Certificate Issuance: When a website owner requests an SSL/TLS certificate from a Certificate Authority (CA), the CA performs due diligence to verify the owner's identity and domain ownership. Once verified, the CA issues a pre-certificate, a preliminary certificate version.
	Log Submission: The CA then submits this pre-certificate to multiple CT logs. Each log is operated by a different organisation, ensuring redundancy and decentralisation. The logs are essentially append-only, meaning that once a certificate is added, it cannot be modified or deleted, ensuring the integrity of the historical record.
	Signed Certificate Timestamp (SCT): Upon receiving the pre-certificate, each CT log generates a Signed Certificate Timestamp (SCT). This SCT is a cryptographic proof that the certificate was submitted to the log at a specific time. The SCT is then included in the final certificate issued to the website owner.
	Browser Verification: When a user's browser connects to a website, it checks the certificate's SCTs. These SCTs are verified against the public CT logs to confirm that the certificate was issued and logged correctly. If the SCTs are valid, the browser establishes a secure connection; if not, it may display a warning to the user.
	Monitoring and Auditing: CT logs are continuously monitored by various entities, including security researchers, website owners, and browser vendors. These monitors look for anomalies or suspicious certificates, such as those issued for domains they don't own or certificates violating industry standards. If any issues are found, they can be reported to the relevant CA for investigation and potential revocation of the certificate.

Cáº¥p phÃ¡t chá»©ng chá»‰: CA xÃ¡c minh danh tÃ­nh vÃ  quyá»n sá»Ÿ há»¯u miá»n, sau Ä‘Ã³ táº¡o pre-certificate.
Gá»­i log: CA gá»­i pre-certificate lÃªn nhiá»u Certificate Transparency (CT) logs, lÃ  há»‡ thá»‘ng chá»‰ ghi thÃªm, Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n.
SCT (Signed Certificate Timestamp): CT log tráº£ vá» SCT â€“ báº±ng chá»©ng mÃ£ hÃ³a cho tháº¥y chá»©ng chá»‰ Ä‘Ã£ Ä‘Æ°á»£c ghi nháº­n. SCT nÃ y Ä‘Æ°á»£c gáº¯n vÃ o chá»©ng chá»‰ cuá»‘i cÃ¹ng.
TrÃ¬nh duyá»‡t kiá»ƒm tra: Khi ngÆ°á»i dÃ¹ng truy cáº­p website, trÃ¬nh duyá»‡t xÃ¡c minh SCT trong chá»©ng chá»‰ vá»›i cÃ¡c CT logs cÃ´ng khai; náº¿u há»£p lá»‡ thÃ¬ káº¿t ná»‘i an toÃ n.
GiÃ¡m sÃ¡t & kiá»ƒm toÃ¡n: Nhiá»u bÃªn (CA, nhÃ  nghiÃªn cá»©u, trÃ¬nh duyá»‡t, chá»§ website) theo dÃµi CT logs Ä‘á»ƒ phÃ¡t hiá»‡n chá»©ng chá»‰ sai pháº¡m vÃ  yÃªu cáº§u thu há»“i náº¿u cáº§n.

The Merkle Tree Structure
To ensure CT logs' integrity and tamper-proof nature, they employ a Merkle tree cryptographic structure. This structure organises the certificates in a tree-like fashion, where each leaf node represents a certificate, and each non-leaf node represents a hash of its child nodes. The root of the tree, known as the Merkle root, is a single hash representing the entire log.
	Let's visualise this with a hypothetical Merkle tree for inlanefreight.com:

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Root Hash                    â”‚
                    â”‚ (Hash of All Below)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                             â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Hash 1                â”‚                    â”‚ Hash 2                â”‚
 â”‚ (Hash of Cert 1 & 2)  â”‚                    â”‚ (Hash of Cert 3 & 4)  â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                 â”‚                          â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cert 1       â”‚  â”‚ Cert 2       â”‚          â”‚ Cert 3       â”‚  â”‚ Cert 4       â”‚
â”‚ inlanefreightâ”‚  â”‚ blog.inlane  â”‚          â”‚ dev.inlane   â”‚  â”‚ api.inlane   â”‚
â”‚ .com         â”‚  â”‚ freight.com  â”‚          â”‚ freight.com  â”‚  â”‚ freight.com  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Root Hash:
	Root Hash: NÃºt gá»‘c Ä‘áº¡i diá»‡n cho toÃ n bá»™ tráº¡ng thÃ¡i log (hash tá»•ng cá»§a táº¥t cáº£ chá»©ng chá»‰).
	Hash 1 & Hash 2: NÃºt trung gian â€” má»—i cÃ¡i lÃ  hash cá»§a hai nÃºt con (cÃ¡c chá»©ng chá»‰ hoáº·c hash khÃ¡c).
	Cert 1 â€“ Cert 4: NÃºt lÃ¡ â€” Ä‘áº¡i diá»‡n cho cÃ¡c chá»©ng chá»‰ SSL/TLS cá»§a cÃ¡c subdomain (inlanefreight.com, blog, dev, api).
CÃ¡ch xÃ¡c minh má»™t chá»©ng chá»‰ (vÃ­ dá»¥ Cert 2 â€“ blog.inlanefreight.com):
	DÃ¹ng hash cá»§a Cert 2 Ä‘á»ƒ xÃ¡c minh chá»©ng chá»‰ gá»‘c.
	Káº¿t há»£p vá»›i Hash 1 Ä‘á»ƒ chá»©ng minh ráº±ng Cert 2 thuá»™c cáº·p vá»›i Cert 1.
	DÃ¹ng Root Hash Ä‘á»ƒ xÃ¡c nháº­n ráº±ng Hash 1 lÃ  má»™t pháº§n há»£p lá»‡ cá»§a toÃ n bá»™ log.

CT Logs and Web Recon
Nguá»“n thÃ´ng tin xÃ¡c thá»±c, khÃ´ng Ä‘oÃ¡n mÃ²: CT logs chá»©a báº£n ghi thá»±c táº¿ cá»§a cÃ¡c chá»©ng chá»‰ Ä‘Ã£ cáº¥p cho domain vÃ  subdomain, nÃªn khÃ´ng phá»¥ thuá»™c vÃ o wordlist hay brute-force.
ToÃ n diá»‡n vÃ  lá»‹ch sá»­: Hiá»ƒn thá»‹ cáº£ subdomain cÅ©/khÃ´ng hoáº¡t Ä‘á»™ng hoáº·c Ä‘Ã£ háº¿t háº¡n chá»©ng chá»‰ â€” nhá»¯ng má»¥c nÃ y cÃ³ thá»ƒ hÃ© lá»™ cáº¥u hÃ¬nh/phiÃªn báº£n pháº§n má»m lá»—i thá»i.
Hiá»‡u quáº£: TÃ¬m Ä‘Æ°á»£c nhiá»u subdomain mÃ  brute-force cÃ³ thá»ƒ bá» sÃ³t (nhá»¯ng tÃªn khÃ³ Ä‘oÃ¡n hoáº·c khÃ´ng trong tá»« Ä‘iá»ƒn).
Rá»§i ro há»¯u Ã­ch cho pentest: Subdomain tá»« CT cÃ³ thá»ƒ lÃ  Ä‘iá»ƒm dá»… táº¥n cÃ´ng do cáº¥u hÃ¬nh cÅ©/thiáº¿u vÃ¡.
Káº¿t luáº­n: CT logs lÃ  cÃ´ng cá»¥ nhanh, tin cáº­y vÃ  bá»• sung ráº¥t máº¡nh cho thu tháº­p thÃ´ng tin (recon) so vá»›i phÆ°Æ¡ng phÃ¡p Ä‘oÃ¡n tÃªn truyá»n thá»‘ng.

Searching CT Logs
There are two popular options for searching CT logs:
| **Tool**   | **Key Features**                                                                                                     | **Use Cases**                                                                                             | **Pros**                                                    | **Cons**                                     |
| ---------- | -------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- | -------------------------------------------- |
| **crt.sh** | User-friendly web interface, simple domain search, displays certificate details and SAN entries.                     | Quick and easy searches, identifying subdomains, checking certificate issuance history.                   | Free, easy to use, no registration required.                | Limited filtering and analysis options.      |
| **Censys** | Powerful search engine for internet-connected devices, advanced filtering by domain, IP, and certificate attributes. | In-depth analysis of certificates, identifying misconfigurations, finding related certificates and hosts. | Extensive data and filtering options, API access available. | Requires registration (free tier available). |


crt.sh lookup
While crt.sh offers a convenient web interface, you can also leverage its API for automated searches directly from your terminal. Let's see how to find all 'dev' subdomains on facebook.com using curl and jq:

naruto3co@htb[/htb]$ curl -s "https://crt.sh/?q=facebook.com&output=json" | jq -r '.[] | select(.name_value | contains("dev")) | .name_value' | sort -u
	*.dev.facebook.com
	*.newdev.facebook.com
	*.secure.dev.facebook.com
	dev.facebook.com
	devvm1958.ftw3.facebook.com
	facebook-amex-dev.facebook.com
	facebook-amex-sign-enc-dev.facebook.com
	newdev.facebook.com
	secure.dev.facebook.com

		curl -s "https://crt.sh/?q=facebook.com&output=json": This command fetches the JSON output from crt.sh for certificates matching the domain facebook.com.
		jq -r '.[] | select(.name_value | contains("dev")) | .name_value': This part filters the JSON results, selecting only entries where the name_value field (which contains the domain or subdomain) includes the string "dev". The -r flag tells jq to output raw strings.
		sort -u: This sorts the results alphabetically and removes duplicates.













