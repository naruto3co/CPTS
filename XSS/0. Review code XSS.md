# XSS Code Review ‚Äî T·ªïng h·ª£p d·∫•u hi·ªáu nh·∫≠n bi·∫øt l·ªó h·ªïng XSS

## 1. Gi·ªõi thi·ªáu
Cross-Site Scripting (XSS) x·∫£y ra khi ·ª©ng d·ª•ng ƒë∆∞a **d·ªØ li·ªáu kh√¥ng tin c·∫≠y** v√†o HTML/JS tr√™n tr√¨nh duy·ªát m√† **kh√¥ng encode ho·∫∑c sanitize ƒë√∫ng c√°ch**.  
ƒê·ªÉ review code hi·ªáu qu·∫£, ta c·∫ßn n·∫Øm r√µ m·ªçi **pattern**, **API nguy hi·ªÉm**, **ngu·ªìn d·ªØ li·ªáu (source)** v√† **ƒëi·ªÉm ch√®n d·ªØ li·ªáu (sink)**.

---

## 2. C√°c pattern nguy hi·ªÉm trong code d·ªÖ d·∫´n ƒë·∫øn XSS

### ‚ùå 2.1 Ch√®n tr·ª±c ti·∫øp d·ªØ li·ªáu user v√†o HTML m√† kh√¥ng encode
```php
echo "<p>Xin ch√†o " . $_GET['name'] . "</p>";
```

### ‚ùå 2.2 N·ªëi chu·ªói t·∫°o HTML
```java
response.getWriter().println("<h1>" + username + "</h1>");
```

### ‚ùå 2.3 D·ªØ li·ªáu user trong thu·ªôc t√≠nh HTML
```php
echo "<div title='$title'>";
```

### ‚ùå 2.4 L·ªçc blacklist
```php
$input = str_replace("<script>", "", $input);
```

### ‚ùå 2.5 T·∫Øt auto-escape trong template
- `|safe` (Django/Jinja2)  
- `@Html.Raw` (.NET)  
- `{{{ var }}}` (Handlebars)

---

## 3. API Frontend & Backend d·ªÖ g√¢y XSS

| API/H√†m | Ng·ªØ c·∫£nh | M√¥ t·∫£ nguy c∆° |
|--------|----------|---------------|
| **innerHTML** | JS | Parse HTML ‚Üí th·ª±c thi script |
| **document.write** | JS | Ch√®n HTML th√¥ |
| **eval()** | JS | Th·ª±c thi chu·ªói nh∆∞ JS |
| **insertAdjacentHTML** | JS | Sink nguy hi·ªÉm |
| **dangerouslySetInnerHTML** | React | Ch√®n HTML kh√¥ng ki·ªÉm so√°t |
| **echo/print** | PHP | Xu·∫•t th·∫≥ng ra HTML |
| **Response.Write** | ASP/.NET | Xu·∫•t HTML raw |
| **out.print** | Java | Render chu·ªói th√¥ |

---

## 4. Source ‚Üí Sink: C√°ch truy v·∫øt XSS

### **4.1 Source (ngu·ªìn d·ªØ li·ªáu)**
- `$_GET`, `$_POST`, `$_COOKIE`
- `request.getParameter()`
- `req.query`, `req.body`
- `location.search`, `location.hash`
- D·ªØ li·ªáu l∆∞u trong DB

### **4.2 Sink (ƒëi·ªÉm render)**
- HTML output (echo/print)
- Template engine
- DOM APIs: `innerHTML`, `outerHTML`, `insertAdjacentHTML`
- JS execution: `eval`, `setTimeout(str)`

### **4.3 C√¥ng th·ª©c t·∫°o XSS**
```
Source ‚Üí (kh√¥ng sanitize/encode) ‚Üí Sink
```

---

## 5. DOM XSS ‚Äî D·∫•u hi·ªáu nh·∫≠n bi·∫øt

### üîç 5.1 Ngu·ªìn DOM nguy hi·ªÉm
- `location.hash`
- `location.search`
- `document.referrer`
- `window.name`

### üîç 5.2 Sink DOM nguy hi·ªÉm
```js
box.innerHTML = location.hash.substring(1);
```

---

## 6. XSS ph·∫£n h·ªìi (Reflected XSS)

### üî• D·∫•u hi·ªáu:
- In l·∫°i tham s·ªë trong URL  
- Hi·ªÉn th·ªã l·ªói k√®m d·ªØ li·ªáu nh·∫≠p  
- Trang search / form tr·∫£ l·∫°i n·ªôi dung

V√≠ d·ª•:
```php
echo "Search: " . $_GET['q'];
```

---

## 7. XSS l∆∞u tr·ªØ (Stored XSS)

### üî• D·∫•u hi·ªáu:
- N·ªôi dung user ƒë∆∞·ª£c l∆∞u DB r·ªìi hi·ªÉn th·ªã l·∫°i  
- Comment, profile, chat, b√†i post

V√≠ d·ª•:
```php
save($_POST['comment']);
echo $commentFromDB;
```

---

## 8. Checklist Audit XSS To√†n di·ªán

### üß© Ki·ªÉm tra Input Sources
- [ ] URL params
- [ ] POST body
- [ ] Cookies / User-Agent
- [ ] DB fields do user t·∫°o

### üß© Ki·ªÉm tra Output Sinks
- [ ] innerHTML / outerHTML
- [ ] insertAdjacentHTML
- [ ] eval / Function
- [ ] echo / print
- [ ] t·∫Øt auto-escape

### üß© Ki·ªÉm tra Encode/Sanitize
- [ ] HTML encode?
- [ ] JS encode?
- [ ] URL encode?
- [ ] textContent thay v√¨ innerHTML?

### üß© Bypass & ƒêi·ªÉm y·∫øu ph·ªï bi·∫øn
- [ ] Code d√πng raw HTML?
- [ ] Filter blacklist?
- [ ] ‚Äúsafe/raw/trustAsHtml‚Äù?

---

## 9. K·∫øt lu·∫≠n
Khi review code t√¨m XSS, lu√¥n nh·ªõ:

> **D·ªØ li·ªáu kh√¥ng tin c·∫≠y ‚Üí ph·∫£i ƒë∆∞·ª£c encode ho·∫∑c sanitize tr∆∞·ªõc khi ƒë∆∞a v√†o HTML/JS.**

---

*File t·ªïng h·ª£p audit XSS cho CPTS / HackTheBox.*
