======================================================
NETWORK SERVICES PASSWORD ATTACKS - FULL NOTES
======================================================

ğŸ¯ Má»¤C TIÃŠU TÃ€I LIá»†U
--------------------
Khi thá»±c hiá»‡n pentest, háº§u nhÆ° má»i há»‡ thá»‘ng máº¡ng Ä‘á»u cung cáº¥p má»™t sá»‘ dá»‹ch vá»¥
Ä‘á»ƒ quáº£n lÃ½, trao Ä‘á»•i dá»¯ liá»‡u hoáº·c Ä‘iá»u khiá»ƒn há»‡ thá»‘ng tá»« xa. Nhá»¯ng dá»‹ch vá»¥ nÃ y
thÆ°á»ng Ä‘Æ°á»£c báº£o vá»‡ báº±ng username & password. Náº¿u cÃ¡c máº­t kháº©u yáº¿u hoáº·c máº·c Ä‘á»‹nh,
káº» táº¥n cÃ´ng cÃ³ thá»ƒ brute-force hoáº·c dÃ² quÃ©t Ä‘á»ƒ truy cáº­p trÃ¡i phÃ©p.

TÃ i liá»‡u nÃ y sáº½ giÃºp báº¡n:
1. Hiá»ƒu vai trÃ² vÃ  cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a cÃ¡c dá»‹ch vá»¥ máº¡ng quan trá»ng.
2. Náº¯m Ä‘Æ°á»£c port máº·c Ä‘á»‹nh, cÃ´ng cá»¥ phá»• biáº¿n Ä‘á»ƒ brute-force.
3. Biáº¿t cÃ¡ch xá»­ lÃ½ sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng (háº­u khai thÃ¡c).
4. Nháº­n biáº¿t rá»§i ro vÃ  Ä‘á» xuáº¥t phÃ²ng thá»§.

CÃ¡c dá»‹ch vá»¥ phá»• biáº¿n Ä‘Æ°á»£c nháº¯c Ä‘áº¿n:
FTP, SMB, NFS, IMAP/POP3, SSH, MySQL/MSSQL, RDP, WinRM, VNC, Telnet, SMTP, LDAP.
Trong pháº§n nÃ y, chÃºng ta táº­p trung vÃ o 4 dá»‹ch vá»¥ quan trá»ng: WinRM, SSH, RDP, SMB.

------------------------------------------------------
1ï¸âƒ£ WINRM (Windows Remote Management)
------------------------------------------------------
ğŸ“ Äáº·t váº¥n Ä‘á»:
WinRM lÃ  cÆ¡ cháº¿ quáº£n lÃ½ Windows tá»« xa thÃ´ng qua giao thá»©c WS-Management
(SOAP/XML). NÃ³ giÃºp admin quáº£n lÃ½ há»‡ thá»‘ng, cháº¡y lá»‡nh tá»« xa báº±ng PowerShell.
Náº¿u káº» táº¥n cÃ´ng Ä‘oÃ¡n Ä‘Æ°á»£c user/pass, háº¯n cÃ³ thá»ƒ kiá»ƒm soÃ¡t há»‡ thá»‘ng nhÆ° má»™t admin.

ğŸ”Œ Port: 5985 (HTTP), 5986 (HTTPS)
ğŸ“š CÆ¡ cháº¿: Cho phÃ©p gá»i WMI/DCOM qua SOAP, thá»±c thi lá»‡nh tá»« xa.

ğŸ”§ CÃ´ng cá»¥ & Quy trÃ¬nh:
  â€¢ NetExec
    - QuÃ©t & brute-force:
      netexec winrm <IP> -u user.list -p password.list
    - ThÃªm --jitter Ä‘á»ƒ giáº£m tá»‘c Ä‘á»™ trÃ¡nh lockout:
      netexec winrm <IP> -u user.list -p password.list --jitter 2
    - Dáº¥u hiá»‡u thÃ nh cÃ´ng:
      [+] <host>\<user>:<pass> (Pwn3d!)
    - Náº¿u tháº¥y (Pwn3d!) nghÄ©a lÃ  chÃºng ta cÃ³ thá»ƒ má»Ÿ shell tá»« xa.

  â€¢ Evil-WinRM
    - DÃ¹ng Ä‘á»ƒ káº¿t ná»‘i vÃ  cÃ³ shell PowerShell:
      evil-winrm -i <IP> -u <user> -p <password>
    - CÃ³ thá»ƒ upload file, dump credential, cháº¡y lá»‡nh tÃ¹y Ã½.

ğŸ¯ Háº­u khai thÃ¡c:
- Dump thÃ´ng tin há»‡ thá»‘ng (whoami, hostname, ipconfig).
- Leo thang Ä‘áº·c quyá»n vá»›i PowerShell script.
- Duy trÃ¬ persistence báº±ng cÃ¡ch thÃªm user hoáº·c implant.

ğŸ’¡ LÆ°u Ã½:
- WinRM máº·c Ä‘á»‹nh táº¯t trÃªn Windows 10/11, chá»‰ báº­t trong domain/lab.
- Cáº§n cáº©n tháº­n Ä‘á»ƒ trÃ¡nh account lockout trong mÃ´i trÆ°á»ng tháº­t.

------------------------------------------------------
2ï¸âƒ£ SSH (Secure Shell)
------------------------------------------------------
ğŸ“ Äáº·t váº¥n Ä‘á»:
SSH lÃ  dá»‹ch vá»¥ káº¿t ná»‘i an toÃ n Ä‘áº¿n há»‡ thá»‘ng (thÆ°á»ng lÃ  Linux).
NÃ³ dÃ¹ng 3 lá»›p báº£o máº­t: mÃ£ hÃ³a Ä‘á»‘i xá»©ng (AES, 3DES), báº¥t Ä‘á»‘i xá»©ng (RSA),
vÃ  hashing Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n. Náº¿u brute-force thÃ nh cÃ´ng,
ta cÃ³ thá»ƒ Ä‘iá»u khiá»ƒn há»‡ thá»‘ng vá»›i quyá»n user tá»« xa.

ğŸ”Œ Port: 22
ğŸ“š CÆ¡ cháº¿: MÃ£ hÃ³a phiÃªn káº¿t ná»‘i, dÃ¹ng key exchange (Diffie-Hellman) Ä‘á»ƒ sinh key bÃ­ máº­t.

ğŸ”§ CÃ´ng cá»¥ & Quy trÃ¬nh:
  â€¢ Hydra
    hydra -L user.list -P password.list ssh://<IP> -t 4
    (giáº£m thread Ä‘á»ƒ trÃ¡nh bá»‹ cháº·n)
  
  â€¢ OpenSSH Client
    - Káº¿t ná»‘i:
      ssh user@<IP>
    - Hoáº·c dÃ¹ng private key:
      ssh -i id_rsa user@<IP>

ğŸ¯ Háº­u khai thÃ¡c:
- Kiá»ƒm tra quyá»n sudo.
- Táº£i file /etc/passwd, /etc/shadow Ä‘á»ƒ offline cracking.
- ThÃªm SSH key vÃ o ~/.ssh/authorized_keys Ä‘á»ƒ backdoor.

ğŸ’¡ LÆ°u Ã½:
- SSH báº£o máº­t cao, brute-force cháº­m.
- Náº¿u cÃ³ private key khÃ´ng Ä‘Æ°á»£c báº£o vá»‡ passphrase â†’ Ä‘Äƒng nháº­p trá»±c tiáº¿p.

------------------------------------------------------
3ï¸âƒ£ RDP (Remote Desktop Protocol)
------------------------------------------------------
ğŸ“ Äáº·t váº¥n Ä‘á»:
RDP cho phÃ©p quáº£n trá»‹ viÃªn Ä‘iá»u khiá»ƒn Windows tá»« xa thÃ´ng qua GUI.
Káº» táº¥n cÃ´ng brute-force thÃ nh cÃ´ng cÃ³ thá»ƒ xem mÃ n hÃ¬nh, Ä‘iá»u khiá»ƒn chuá»™t,
gÃµ phÃ­m, copy file.

ğŸ”Œ Port: 3389
ğŸ“š CÆ¡ cháº¿: Gá»­i dá»¯ liá»‡u hÃ¬nh áº£nh, Ã¢m thanh, input giá»¯a client-server.

ğŸ”§ CÃ´ng cá»¥ & Quy trÃ¬nh:
  â€¢ Hydra
    hydra -L user.list -P password.list rdp://<IP> -t 1
    (giáº£m threads Ä‘á»ƒ trÃ¡nh lockout)
  
  â€¢ xfreerdp
    xfreerdp /v:<IP> /u:<user> /p:<password>
    (nháº¥n Y khi Ä‘Æ°á»£c há»i vá» chá»©ng chá»‰ tá»± kÃ½)

ğŸ¯ Háº­u khai thÃ¡c:
- Má»Ÿ Command Prompt/PowerShell trÃªn phiÃªn RDP.
- CÃ i Ä‘áº·t backdoor, exfiltrate dá»¯ liá»‡u.

ğŸ’¡ LÆ°u Ã½:
- Má»™t sá»‘ tÃ i khoáº£n cÃ³ password Ä‘Ãºng nhÆ°ng chÆ°a enable Remote Desktop â†’ cáº§n báº­t qua registry hoáº·c dÃ¹ng WinRM/SMB trÆ°á»›c.

------------------------------------------------------
4ï¸âƒ£ SMB (Server Message Block)
------------------------------------------------------
ğŸ“ Äáº·t váº¥n Ä‘á»:
SMB dÃ¹ng Ä‘á»ƒ chia sáº» file, thÆ° má»¥c, mÃ¡y in trong máº¡ng LAN.
Náº¿u ta tÃ¬m Ä‘Æ°á»£c máº­t kháº©u user, ta cÃ³ thá»ƒ truy cáº­p share quan trá»ng,
táº£i file nháº¡y cáº£m hoáº·c tháº­m chÃ­ thá»±c thi code (náº¿u cÃ³ quyá»n ghi).

ğŸ”Œ Port: 445
ğŸ“š CÆ¡ cháº¿: Client-server, há»— trá»£ xÃ¡c thá»±c NTLM/kerberos.

ğŸ”§ CÃ´ng cá»¥ & Quy trÃ¬nh:
  â€¢ Hydra
    hydra -L user.list -P password.list smb://<IP>
    (náº¿u lá»—i SMBv3 â†’ dÃ¹ng Metasploit)

  â€¢ Metasploit
    use auxiliary/scanner/smb/smb_login
    set USER_FILE user.list
    set PASS_FILE password.list
    set RHOSTS <IP>
    run

  â€¢ NetExec
    netexec smb <IP> -u user -p password --shares
    (liá»‡t kÃª share & quyá»n truy cáº­p)

  â€¢ smbclient
    smbclient -U user \\\\<IP>\\<SHARENAME>
    ls, get <file>, put <file>

ğŸ¯ Háº­u khai thÃ¡c:
- Kiá»ƒm tra quyá»n ghi trÃªn share â†’ upload shell.
- Dump SAM, SYSTEM náº¿u cÃ³ quyá»n admin (qua ADMIN$).
- Pivot sang cÃ¡c mÃ¡y khÃ¡c qua share.

ğŸ’¡ LÆ°u Ã½:
- Náº¿u láº¥y Ä‘Æ°á»£c NTLM hash â†’ dÃ¹ng ká»¹ thuáº­t Pass-the-Hash.
- SMB hay bá»‹ brute-force lockout â†’ cáº©n tháº­n sá»‘ láº§n thá»­.

------------------------------------------------------
ğŸ“Œ CHIáº¾N LÆ¯á»¢C Tá»”NG QUAN
------------------------------------------------------
1. Thu tháº­p thÃ´ng tin dá»‹ch vá»¥ & port má»Ÿ (nmap -sV).
2. Chuáº©n bá»‹ user.list & password.list (seclists, cewl, custom).
3. DÃ² quÃ©t tá»«ng dá»‹ch vá»¥ theo cá»•ng tÆ°Æ¡ng á»©ng.
4. Sau khi cÃ³ thÃ´ng tin Ä‘Äƒng nháº­p â†’ káº¿t ná»‘i báº±ng cÃ´ng cá»¥ client.
5. Thá»±c hiá»‡n háº­u khai thÃ¡c (thu tháº­p thÃ´ng tin, leo thang Ä‘áº·c quyá»n).
6. BÃ¡o cÃ¡o vÃ  Ä‘á» xuáº¥t phÃ²ng thá»§: disable account máº·c Ä‘á»‹nh, enforce password policy, enable account lockout, báº­t MFA.

------------------------------------------------------
PHÃ’NG THá»¦
------------------------------------------------------
- Äá»•i password máº·c Ä‘á»‹nh, Ä‘áº·t password máº¡nh.
- Giá»›i háº¡n sá»‘ láº§n Ä‘Äƒng nháº­p tháº¥t báº¡i (lockout policy).
- Báº­t logging & alert vá»›i sá»± kiá»‡n Ä‘Äƒng nháº­p tháº¥t báº¡i.
- Sá»­ dá»¥ng MFA cho SSH, RDP, WinRM náº¿u cÃ³ thá»ƒ.
- Giá»›i háº¡n dá»‹ch vá»¥ chá»‰ má»Ÿ cho Ä‘á»‹a chá»‰ IP tin cáº­y (firewall).

======================================================
